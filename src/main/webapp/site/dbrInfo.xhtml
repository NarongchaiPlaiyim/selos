<!DOCTYPE html>
<html>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:clv="http://clevel.com/ui">

<h:head>
    <title>#{msg.get('app.dbr.title')}</title>
    <h:outputStylesheet name="css/style.css" />
    <h:outputScript library="js" name="custom.js" />

</h:head>
<h:body>
<p:panel id="pnl_maincontainer" style="border:0; margin:0; padding: 0;">
    <h:form id="frmMain">
        <div id="main_container">
            <!-- Start Header Logo -->
            <ui:include src="include/header_logo.xhtml"/>
            <!-- End Header Logo -->
            <!-- Start Header Detail -->
            <ui:include src="include/header_detail.xhtml"/>
            <!-- End Header Detail -->
            <!-- Start Menu -->
            <ui:include src="include/menubar.xhtml"/>
            <!-- End Menu -->
            <div id="content_container">
                <div id="content_name">#{msg.get('app.dbr.header')}</div>
                <div id="content">
                    <div id="content_info">
                        <div id="content_trackchange">[ View Track Change ]</div>
                        <div id="content_lastupdate">Last update by
                            <h:outputText value="#{dbrInfo.dbr.modifyBy}"/>,
                            <p:outputLabel value="#{dbrInfo.dbr.modifyDate}">
                                <f:convertDateTime locale="th_TH" pattern="dd/MM/yyyy" type="date"/>
                            </p:outputLabel>
                        </div>
                    </div>
                    <div id="content_form">
                        <!-- start content -->
                        <table class="content_table_form">
                            <tr>
                                <td>
                                    <table>
                                        <tr>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.incomeFactor')}"/>
                                                <h:outputText value="#{dbrInfo.mandate('incomeFactor')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td>
                                                <p:inputText id="incomeFactor" value="#{dbrInfo.dbr.incomeFactor}" style="text-align: right"
                                                             disabled="#{dbrInfo.isDisabled('incomeFactor')}"
                                                             required="#{not empty param[dbrSaveBtn.clientId]}" readonly="true">
                                                     <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                                </p:inputText>
                                            </td>
                                            <td style="min-width: 250px; width: 250px; max-width: 250px"></td>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.dbrInterest')}" styleClass="center"/>
                                                <h:outputText value="#{dbrInfo.mandate('DBRInterest')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td >
                                                <p:inputText id="dbrInterest" maxlength="18" value="#{dbrInfo.dbr.dbrInterest}"
                                                             disabled="#{dbrInfo.isDisabled('DBRInterest')}"
                                                             style="text-align: right">
                                                    <f:convertNumber  type="number" minFractionDigits="2" maxFractionDigits="2"/>
                                                </p:inputText>
                                            </td>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.dbrInterest.MRR')}" styleClass="center"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.monthlyIncome')}" styleClass="center"/>
                                                <h:outputText value="#{dbrInfo.mandate('monthlyIncome')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td>
                                                <p:inputText id="monthlyIncome" maxlength="18" value="#{dbrInfo.dbr.monthlyIncome}"
                                                             disabled="#{dbrInfo.isDisabled('monthlyIncome')}"
                                                             style="text-align: right">
                                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2"/>
                                                </p:inputText>
                                            </td>
                                            <td colspan="3"></td>
                                        </tr>
                                        <tr>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.monthlyIncomeAdjust')}" styleClass="center" />
                                                <h:outputText value="#{dbrInfo.mandate('monthlyIncomeAdjust')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td>
                                                <p:inputText id="monthlyIncomeAdjust" value="#{dbrInfo.dbr.monthlyIncomeAdjust}"
                                                             disabled="#{dbrInfo.isDisabled('monthlyIncomeAdjust')}"
                                                             style="text-align: right;" required="#{not empty param[dbrSaveBtn.clientId]}"  onclick="this.select()"
                                                             onkeydown="return onKeyDownMoney(event);" onkeypress="return onKeyPressMoney(event);">
                                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                                    <p:ajax event="change" update=":frmMain:monthlyIncomeAdjust"/>

                                                </p:inputText>
                                            </td>
                                            <td colspan="3"></td>
                                        </tr>
                                        <tr>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.monthlyIncomePerMonth')}" styleClass="center"/>
                                                <h:outputText value="#{dbrInfo.mandate('monthlyIncomePerMonth')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td>
                                                <p:inputText id="monthlyIncomePerMonth" value="#{dbrInfo.dbr.monthlyIncomePerMonth}"
                                                             disabled="#{dbrInfo.isDisabled('monthlyIncomePerMonth')}"
                                                             style="text-align: right" required="#{not empty param[dbrSaveBtn.clientId]}"  onclick="this.select()"
                                                             onkeydown="return onKeyDownMoney(event);" onkeypress="return onKeyPressMoney(event);" >
                                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                                    <p:ajax event="change" update=":frmMain:monthlyIncomePerMonth"/>
                                                </p:inputText>
                                            </td>
                                            <td colspan="2"></td>
                                        </tr>
                                        <tr>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.netMonthlyIncome')}" styleClass="center"/>
                                                <h:outputText value="#{dbrInfo.mandate('netMonthlyIncome')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td>
                                                <p:inputText id="netMonthlyIncome" maxlength="14" value="#{dbrInfo.dbr.netMonthlyIncome}"
                                                             disabled="#{dbrInfo.isDisabled('netMonthlyIncome')}"
                                                             style="text-align: right">
                                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                                </p:inputText>
                                            </td>
                                            <td style="min-width: 250px; width: 250px; max-width: 250px;"></td>
                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.currentDBR')}" styleClass="center"/>
                                                <h:outputText value="#{dbrInfo.mandate('currentDBR')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td>
                                                <p:inputText id="currentDBR" maxlength="14" value="#{dbrInfo.dbr.currentDBR}"
                                                             disabled="#{dbrInfo.isDisabled('currentDBR')}"
                                                             style="text-align: right">
                                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                                </p:inputText>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="3" ></td>

                                            <td class="title">
                                                <p:outputLabel value="#{msg.get('app.dbr.label.dbrBeforeRequest')}" styleClass="center"/>
                                                <h:outputText value="#{dbrInfo.mandate('DBRBeforeRequest')}" styleClass="require-field"/>
                                                <h:outputText value=" :"/>
                                            </td>
                                            <td>
                                                <p:inputText id="dbrBeforeRequest" maxlength="14" value="#{dbrInfo.dbr.dbrBeforeRequest}"
                                                             disabled="#{dbrInfo.isDisabled('DBRBeforeRequest')}"
                                                             style="text-align: right">
                                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                                    <p:ajax event="change" update=":frmMain:dbrBeforeRequest"/>
                                                </p:inputText>
                                            </td>
                                        </tr>
                                    </table>
                                 </td>
                            </tr>
                            <tr>
                                <td>
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="separate"></div>
                                </td>
                            </tr>
                            <tr>
                                <td class="title top">
                                    <p:outputLabel value="#{msg.get('app.dbr.debtOfBorrowers')}"/>
                                </td>
                            </tr>
                            <tr>
                                <!--*** NCB table *** -->
                                <td>
                                    <p:dataTable value="#{dbrInfo.ncbDetails}" var="itemNCB" rowIndexVar="rowIndex" paginator="false">
                                        <p:column style="min-width: 30px; width:30px; max-width: 30px;">
                                            <p:outputLabel value="#{rowIndex+1}"/>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.accountName')}" style="min-width: 250px; width:250px; max-width: 250px;">
                                            <p:outputLabel value="#{itemNCB.accountName}"/>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.loanTypes')}" style="min-width: 250px; width:250px; max-width: 250px;" styleClass="center">
                                            <h:outputText value="#{itemNCB.loanAccountTypeView.name}"/>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.limit')}" style="min-width: 150px; width:150px; max-width: 1500px;" styleClass="right">
                                            <h:outputText value="#{itemNCB.limit}" >
                                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.installment')}" style="min-width: 150px; width:150px; max-width: 150px;" styleClass="right">
                                            <p:outputLabel value="#{itemNCB.installment}">
                                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                            </p:outputLabel>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.debtForCalculate')}" style="min-width: 150px; width:150px; max-width: 150px;" styleClass="right">
                                            <p:outputLabel value="#{itemNCB.debtForCalculate}">
                                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                            </p:outputLabel>
                                        </p:column>
                                        <p:columnGroup type="footer" >
                                            <p:row >
                                                <p:column  style="border-right: none !important; text-align:right" footerText="#{msg.get('app.dbr.table.total')}" styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>

                                                <p:column style="text-align:right" styleClass="summary_column">
                                                    <f:facet name="footer">
                                                        <p:outputLabel value="#{dbrInfo.totalMonthDebtBorrower}">
                                                            <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2"
                                                                             maxIntegerDigits="14"/>
                                                        </p:outputLabel>
                                                    </f:facet>
                                                </p:column>
                                            </p:row>
                                        </p:columnGroup>
                                    </p:dataTable>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <br/>
                                </td>
                             </tr>
                            <tr>
                                <td>
                                    <div class="separate"></div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <table>
                                        <tr>
                                            <td class="title top">
                                                <h:outputText value="#{msg.get('app.dbr.debtOfConfederate')}"/>
                                            </td>
                                            <td style="padding-left: 10px;">
                                                <p:commandButton value="#{msg.get('app.button.add')}" title="#{msg.get('app.button.add')}"
                                                                 styleClass="smaller"
                                                                 action="#{dbrInfo.initAddDBRDetail}"
                                                                 process="@this"
                                                                 update=":dbrDetailDlgForm"
                                                                 oncomplete="dbrDetailDialog.show()"
                                                                 disabled="#{dbrInfo.isDisabled('addRelatedDebtButton')}">
                                                    <f:setPropertyActionListener value="false" target="#{dbrInfo.update}"/>
                                                </p:commandButton>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <p:dataTable id="dbrDetailDT" value="#{dbrInfo.dbrDetails}" var="item" rowIndexVar="rowIndex" paginator="false">
                                        <p:column headerText=" "  style="min-width: 30px; width:30px; max-width: 30px;">
                                            <p:outputLabel value="#{rowIndex+1}"/>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.accountName')}" style="min-width: 250px; width:250px; max-width: 250px;">
                                            <p:outputLabel value="#{item.accountName}"/>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.loanTypes')}" style="min-width: 250px; width:250px; max-width: 250px;">
                                            <p:outputLabel value="#{item.loanAccountTypeView.name}"/>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.limit')}" style="min-width: 150px; width:150px; max-width: 150px;" styleClass="right">
                                            <p:outputLabel value="#{item.limit}">
                                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                            </p:outputLabel>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.installment')}" style="min-width: 150px; width:150px; max-width: 150px;" styleClass="right">
                                            <p:outputLabel value="#{item.installment}">
                                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                            </p:outputLabel>
                                        </p:column>
                                        <p:column headerText="#{msg.get('app.dbr.table.column.debtForCalculate')}" style="min-width: 150px; width:150px; max-width: 150px;" styleClass="right">
                                            <p:outputLabel value="#{item.debtForCalculate}" >
                                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                                            </p:outputLabel>
                                        </p:column>
                                        <p:column  styleClass="center">
                                            <p:commandButton title="#{msg.get('app.button.edit')}"
                                                             icon="ui-icon-pencil"
                                                             action="#{dbrInfo.initEditDBRDetail()}"
                                                             oncomplete="dbrDetailDialog.show()"
                                                             process="@this"
                                                             update=":dbrDetailDlgForm"
                                                             disabled="#{dbrInfo.isDisabled('related.actionLists')}">
                                                <f:setPropertyActionListener value="#{item}" target="#{dbrInfo.selectedItem}"/>
                                                <f:setPropertyActionListener value="#{rowIndex}" target="#{dbrInfo.rowIndex}"/>
                                                <f:setPropertyActionListener value="true" target="#{dbrInfo.update}"/>
                                                <p:resetInput target=":dbrDetailDlgForm"/>
                                            </p:commandButton>
                                            <p:commandButton title="#{msg.get('app.button.delete')}"
                                                             icon="ui-icon-trash"
                                                             oncomplete="confirmDeleteDBRInfoDlg.show()">
                                                <f:setPropertyActionListener value="#{rowIndex}" target="#{dbrInfo.rowIndex}"/>
                                            </p:commandButton>
                                        </p:column>

                                        <p:columnGroup type="footer" >

                                            <p:row>
                                                <p:column style="border-right: none !important; text-align: right;"  footerText="#{msg.get('app.dbr.table.total')}" styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>
                                                <p:column style="border-left: none !important; border-right: none !important;"  styleClass="summary_column"/>

                                                <p:column style="text-align:right; " styleClass="summary_column">
                                                    <f:facet name="footer">
                                                        <p:outputLabel value="#{dbrInfo.totalMonthDebtRelated}">
                                                            <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2"
                                                                             maxIntegerDigits="14"/>
                                                        </p:outputLabel>
                                                    </f:facet>
                                                </p:column>
                                                <p:column styleClass="summary_column"></p:column>
                                            </p:row>
                                        </p:columnGroup>
                                    </p:dataTable>
                                </td>
                            </tr>
                            <tr>
                                <td><br/></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="separate"></div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="center">
                                        <p:commandButton id="btnSave" value="#{msg.get('app.button.save')}"
                                                         styleClass="medium"
                                                         binding="#{dbrSaveBtn}"
                                                         action="#{dbrInfo.onSaveDBRInfo}"
                                                         onclick="onOneClick('frmMain:btnSave', true);"
                                                         oncomplete="onOneClick('frmMain:btnSave', false);"
                                                         update=":pnl_maincontainer :msgBoxSystemMessagePanel"
                                                         disabled="#{dbrInfo.isDisabled('saveButton')}">
                                        </p:commandButton>
                                        <p:spacer  width="10"/>
                                        <p:commandButton id="btnCancel" value="#{msg.get('app.button.cancel')}"
                                                         styleClass="medium"
                                                         action="#{dbrInfo.onCreation}"
                                                         update=":pnl_maincontainer :msgBoxSystemMessagePanel"
                                                         disabled="#{dbrInfo.isDisabled('cancelButton')}">
                                        </p:commandButton>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div id="bottom_line"/>

            <div class="clear"/>
            <!-- Start Footer -->
            <ui:include src="include/footer.xhtml"/>
        </div>
        <h:inputHidden id="pagename" value="mnuprescreen"/>
        <h:inputHidden id="subpagename" value="submnuprescreen"/>
    </h:form>

<p:blockUI block=":frmMain" trigger=":frmMain:btnSave">
    LOADING<br/>
    <p:graphicImage value="/resources/images/shared/ajax-loader.gif"/>
</p:blockUI>
</p:panel>

<p:panel id="msgBoxSystemMessagePanel" styleClass="panel">
    <p:confirmDialog id="msgBoxSystemMessageDialog" widgetVar="msgBoxSystemMessageDlg"
                     header="#{dbrInfo.messageHeader}" message="#{dbrInfo.message}">
        <p:commandButton value="OK"
                         process="@this"
                         update="frmMain"
                         oncomplete="msgBoxSystemMessageDlg.hide()"/>
    </p:confirmDialog>
</p:panel>

<p:dialog id="dbrDetailDialog" widgetVar="dbrDetailDialog" header="#{msg.get('app.dbrDetail.title')}"
          onShow="hideWindowsScrollBar()" onHide="showWindowsScrollBar()" resizable="false"
          modal="true" width="500" height="200">
    <ui:include src="dialog/dbrDetailDialog.xhtml"/>
</p:dialog>

<ui:include src="dialog/confirmDeleteDlg.xhtml">
    <ui:param name="id" value="confirmDeleteDBRInfoDialog"/>
    <ui:param name="name" value="confirmDeleteDBRInfoDlg"/>
    <ui:param name="formId" value="frmConfirmDeleteDBRInfo"/>
    <ui:param name="controller" value="#{dbrInfo}"/>
    <ui:param name="action" value="onDeletedDBRDetail"/>
    <ui:param name="update" value=":frmMain:dbrDetailDT"/>
</ui:include>
</h:body>
</f:view>
</html>

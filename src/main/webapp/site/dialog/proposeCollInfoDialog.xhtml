<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:clv="http://clevel.com/ui">

<p:panel id="collateralDlgPanel" styleClass="panel-dialog">
<h:form id="collateralDlgForm">
<table class="content_form content_table_form">
<tr>
    <td class="title" style="width: 20%">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.jobID')}"/>
    </td>
    <td class="left" style="width: 30%">
        <p:inputText id="jobID"
                     value="#{creditFacPropose.newCollateralView.jobID}"
                     onclick="this.select()"
                     required="#{not empty param[retrieveButton.clientId]}">
            <p:ajax event="change" listener="#{creditFacPropose.onChangeJobId}" update="@form"/>
        </p:inputText>
    </td>
    <td class="left" colspan="2" style="width: 50%">
        <p:commandButton value="#{msg.get('app.credit.facility.propose.dlg.retrieveButton')}"
                         binding="#{retrieveButton}"
                         styleClass="largest"
                         action="#{creditFacPropose.onCallRetrieveAppraisalReportInfo()}"
                         process="@form"
                         update=":collateralDlgForm,:msgBoxSystemMessagePanel"/>
    </td>
</tr>

<tr>
    <td colspan="4">
        <div class="separate"><!-- --></div>
    </td>
</tr>

<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.appraisalDate')}"/>
    </td>
    <td class="left" colspan="3">
        <clv:BECalendar value="#{creditFacPropose.newCollateralView.appraisalDate}"
                        id="expectSumitDate"
                        showOn="button"
                        pattern="dd/MM/yyyy"
                        yearRange="1950:2100"
                        mindate="01/01/1950"
                        navigator="true"
                        locale="th_TH"
                        showButtonPanel="true"/>
    </td>
</tr>

<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecision')}"/>
    </td>
    <td class="left" colspan="3">
        <p:inputText value="#{creditFacPropose.newCollateralView.aadDecision}"/>
    </td>
</tr>

<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecisionReason')}"/>
    </td>
    <td class="left">
        <p:inputText value="#{creditFacPropose.newCollateralView.aadDecisionReason}"/>
    </td>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecisionReasonDetail')}"/>
    </td>
    <td class="left">
        <p:inputText value="#{creditFacPropose.newCollateralView.aadDecisionReasonDetail}"/>
    </td>
</tr>

<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.usage')}"/>
    </td>
    <td class="left">
        <p:inputText value="#{creditFacPropose.newCollateralView.usage}"/>
    </td>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.typeOfUsage')}"/>
    </td>
    <td class="left">
        <p:inputText value="#{creditFacPropose.newCollateralView.typeOfUsage}"/>
    </td>
</tr>

<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.mortgageCondition')}"/>
    </td>
    <td class="left">
        <p:inputText value="#{creditFacPropose.newCollateralView.mortgageCondition}"/>
    </td>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.mortgageConditionDetail')}"/>
    </td>
    <td class="left">
        <p:inputText value="#{creditFacPropose.newCollateralView.mortgageConditionDetail}"/>
    </td>
</tr>

<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.creditType.caption')}"/>
    </td>
    <td class="left" colspan="3">
        <p:dataTable var="creditTypeDetailItem"
                     value="#{creditFacPropose.newCollateralView.proposeCreditDetailViewList}"
                     style="width: 100%;">

            <p:columnGroup type="header">
                <p:row>
                    <p:column style="width: 5%; padding: 5px 10px !important;"/>
                    <p:column style="width: 40%; padding: 5px 10px !important;"
                              headerText="#{msg.get('app.credit.facility.propose.label.collateral.account')}"/>
                    <p:column style="width: 10%; padding: 5px 10px !important;"
                              headerText="#{msg.get('app.credit.facility.propose.label.collateral.requestCreditType')}"/>
                    <p:column style="width: 15%; padding: 5px 10px !important;"
                              headerText="#{msg.get('app.credit.facility.propose.label.collateral.productProgram')}"/>
                    <p:column style="width: 15%; padding: 5px 10px !important;"
                              headerText="#{msg.get('app.credit.facility.propose.label.collateral.creditFacility')}"/>
                    <p:column style="width: 15%; padding: 5px 10px !important;"
                              headerText="#{msg.get('app.credit.facility.propose.label.collateral.limit')}"/>
                </p:row>

            </p:columnGroup>

            <p:column styleClass="center">
                <h:selectBooleanCheckbox value="#{creditTypeDetailItem.noFlag}"/>
            </p:column>

            <p:column styleClass="left top">
                <h:outputText value="#{creditTypeDetailItem.accountName}"/><br/>
                <h:outputText value="#{creditTypeDetailItem.accountNumber}  #{creditTypeDetailItem.accountSuf}"/>
            </p:column>

            <p:column styleClass="left top">
                #{creditTypeDetailItem.requestType == 2 ? msg.get('app.label.new') :
                        creditTypeDetailItem.requestType == 1 ? msg.get('app.label.change') : ''}
            </p:column>

            <p:column styleClass="left top">
                #{not empty creditTypeDetailItem.productProgramView ? creditTypeDetailItem.productProgramView.name : ''}
            </p:column>

            <p:column styleClass="left top">
                #{not empty creditTypeDetailItem.creditFacilityView ? creditTypeDetailItem.creditFacilityView.name : ''}
            </p:column>

            <p:column styleClass="right top">
                <h:outputText value="#{creditTypeDetailItem.limit}">
                    <f:convertNumber pattern="#,##0.##"
                                     minFractionDigits="2"
                                     maxFractionDigits="2"
                                     maxIntegerDigits="14"/>
                </h:outputText>
            </p:column>

        </p:dataTable>
    </td>
</tr>

<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.BDMComments')}"/>
    </td>
    <td class="left" colspan="3">
        <p:inputTextarea value="#{creditFacPropose.newCollateralView.bdmComments}"
                         cols="100" rows="3"/>
    </td>
</tr>

<tr>
    <td colspan="4">
        <div class="separate"><!-- --></div>
    </td>
</tr>

<!-- Collateral Head -->
<ui:repeat value="#{creditFacPropose.newCollateralView.newCollateralHeadViewList}"
           var="CollateralHeaderDetailView" varStatus="i">
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.potential')}"/>
    </td>
    <td class="left" colspan="3">
        <p:selectOneMenu id="dlgPotentialColl"
                         value="#{CollateralHeaderDetailView.potentialCollateral.id}"
                         style="min-width: 200px; width: 200px; max-width: 200px;"
                         required="#{not empty param[btnSaveCollateral.clientId]}">
            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
            <f:selectItems value="#{creditFacPropose.potentialCollateralList}"
                           var="potentialItem"
                           itemLabel="#{potentialItem.description}"
                           itemValue="#{potentialItem.id}"/>
        </p:selectOneMenu>
    </td>
</tr>
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.collTypePercentLTV')}"/>
    </td>
    <td class="left" colspan="3">
        <p:selectOneMenu id="dlgCollTypePercentLTV"
                         value="#{CollateralHeaderDetailView.collTypePercentLTV.id}"
                         style="min-width: 200px; width: 200px; max-width: 200px;"
                         required="#{not empty param[btnSaveCollateral.clientId]}">
            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
            <f:selectItems value="#{creditFacPropose.collateralTypeList}"
                           var="collTypePercentItem"
                           itemLabel="#{collTypePercentItem.description}"
                           itemValue="#{collTypePercentItem.id}"/>
        </p:selectOneMenu>
    </td>
</tr>
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.existingCredit')}"/>
    </td>
    <td class="left" colspan="3">
        <p:inputText value="#{CollateralHeaderDetailView.existingCredit}"
                     maxlength="18"
                     onclick="this.select()"
                     onkeydown="return onKeyDownMoney(event);"
                     onkeypress="return onKeyPressMoney(event);"
                     style="width:200px;text-align: right">
            <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2"
                             type="number"/>
            <p:ajax event="blur" update="@this"/>
        </p:inputText>
    </td>
</tr>
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.titleDeed')}"/>
    </td>
    <td class="left" colspan="3">
        <p:inputText value="#{CollateralHeaderDetailView.titleDeed}"
                     required="#{not empty param[btnSaveCollateral.clientId]}"/>
    </td>
</tr>
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.collateralLocation')}"/>
    </td>
    <td class="left" colspan="3">
        <p:inputText value="#{CollateralHeaderDetailView.collateralLocation}"
                     style="width: 400px;"
                     required="#{not empty param[btnSaveCollateral.clientId]}"/>
    </td>
</tr>
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.appraisalValue')}"/>
    </td>
    <td class="left" colspan="3">
        <p:inputText value="#{CollateralHeaderDetailView.appraisalValue}"
                     maxlength="18"
                     onclick="this.select()"
                     onkeydown="return onKeyDownMoney(event);"
                     onkeypress="return onKeyPressMoney(event);"
                     required="#{not empty param[btnSaveCollateral.clientId]}"
                     style="width:200px;text-align: right">
            <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2"
                             type="number"/>
            <p:ajax event="blur" update="@this"/>
        </p:inputText>
    </td>
</tr>
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.headCollType')}"/>
    </td>
    <td class="left" colspan="3">
        <p:selectOneMenu id="dlgCollateralType"
                         value="#{CollateralHeaderDetailView.headCollType.id}"
                         style="min-width: 200px; width: 200px; max-width: 200px;"
                         required="#{not empty param[btnSaveCollateral.clientId]}">
            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
            <f:selectItems value="#{creditFacPropose.headCollateralTypeList}"
                           var="headCollateralTypeItem"
                           itemLabel="#{headCollateralTypeItem.description}"
                           itemValue="#{headCollateralTypeItem.id}"/>
        </p:selectOneMenu>
    </td>
</tr>
<tr>
    <td class="title">
        <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.headcoll.insuranceCompany')}"/>
    </td>
    <td class="left" colspan="3">
        <p:selectOneRadio value="#{CollateralHeaderDetailView.insuranceCompany}">
            <f:selectItem itemLabel="#{msg.get('app.button.partner')}" itemValue="2"/>
            <f:selectItem itemLabel="#{msg.get('app.button.nonPartner')}" itemValue="1"/>
        </p:selectOneRadio>
    </td>
</tr>
<tr>
    <td class="left" colspan="4">
        <p:commandButton
                id="btnAddSubCollateralInfo"
                value="#{msg.get('app.addButton')}"
                styleClass="smaller"
                rendered="#{creditFacPropose.flagButtonCollateral}"
                process="@form"
                action="#{creditFacPropose.onAddSubCollateral}"
                update=":subCollateralDlgForm"
                oncomplete="subCollateralInfoDlg.show();">
            <f:setPropertyActionListener value="#{i.index}"
                                         target="#{creditFacPropose.rowCollHeadIndex}"/>
            <p:resetInput target=":subCollateralDlgForm"/>
        </p:commandButton>
    </td>
</tr>

<tr>
    <td class="left" colspan="4">
        <p:dataTable id="subCollateralDetailViewTable"
                     value="#{CollateralHeaderDetailView.newCollateralSubViewList}"
                     var="newCollateralSubView"
                     rowKey="#{newCollateralSubView.SubCollateralDetailView}"
                     rowIndexVar="rowIndex"
                     paginator="false"
                     style="width: 100%;">

            <p:columnGroup type="header">
                <p:row>
                    <p:column style="width: 5%"/>
                    <p:column style="width: 15%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.subcollTypeCaption')}"/>
                    <p:column style="width: 10%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.titleDeed')}"/>
                    <p:column style="width: 10%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.collateralOwner.AAD')}"/>
                    <p:column style="width: 10%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.collateralOwner.UW')}"/>
                    <p:column style="width: 10%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.mortgageType')}"/>
                    <p:column style="width: 10%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.relatedWith')}"/>
                    <p:column style="width: 10%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.appraisalValue')}"/>
                    <p:column style="width: 10%"
                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.mortgageValue')}"/>
                    <p:column style="width: 10%"/>
                </p:row>
            </p:columnGroup>

            <p:column styleClass="center">
                <h:outputText value="#{rowIndex + 1}"/>
            </p:column>

            <p:column styleClass="left top">
                <h:outputText value="#{newCollateralSubView.subCollateralType.description}"
                              rendered="#{not empty newCollateralSubView.subCollateralType}"/><br/>
                <h:outputText value="#{newCollateralSubView.address}"/><br/>
                <h:outputText value="#{newCollateralSubView.landOffice}"/>
            </p:column>

            <p:column styleClass="left top">
                <h:outputText value="#{newCollateralSubView.titleDeed}"/>
            </p:column>

            <p:column styleClass="left top">
                <h:outputText value="#{newCollateralSubView.collateralOwnerAAD}"/>
            </p:column>

            <p:column styleClass="left top">
                <p:panel rendered="#{not empty newCollateralSubView.collateralOwnerUWList
                                 and fn:length(newCollateralSubView.collateralOwnerUWList) gt 0}" styleClass="panel">
                    <ui:repeat value="#{newCollateralSubView.collateralOwnerUWList}"
                               var="collateralOwnerUW" varStatus="a">
                        <h:outputText value="#{collateralOwnerUW.firstNameTh} #{collateralOwnerUW.lastNameTh}"/>
                        <h:outputText value="," rendered="#{not a.last}"/>
                    </ui:repeat>
                </p:panel>
            </p:column>

            <p:column styleClass="left top">
                <p:panel rendered="#{not empty newCollateralSubView.mortgageList
                                 and fn:length(newCollateralSubView.mortgageList) gt 0}" styleClass="panel">
                    <ui:repeat value="#{newCollateralSubView.mortgageList}"
                               var="mortgage" varStatus="b">
                        <h:outputText value="#{mortgage.mortgage}"/>
                        <h:outputText value="," rendered="#{not b.last}"/>
                    </ui:repeat>
                </p:panel>
            </p:column>

            <p:column styleClass="left top">
                <p:panel rendered="#{not empty newCollateralSubView.relatedWithList
                                 and fn:length(newCollateralSubView.relatedWithList) gt 0}" styleClass="panel">
                    <ui:repeat value="#{newCollateralSubView.relatedWithList}"
                               var="relatedWith" varStatus="c">
                        <h:outputText value="#{relatedWith.titleDeed}"/>
                        <h:outputText value="," rendered="#{not c.last}"/>
                    </ui:repeat>
                </p:panel>
            </p:column>

            <p:column styleClass="right top">
                <h:outputText value="#{newCollateralSubView.appraisalValue}">
                    <f:convertNumber pattern="#,##0.##"
                                     minFractionDigits="2"
                                     maxFractionDigits="2"
                                     maxIntegerDigits="14"/>
                </h:outputText>
            </p:column>

            <p:column styleClass="right top">
                <h:outputText value="#{newCollateralSubView.mortgageValue}">
                    <f:convertNumber pattern="#,##0.##"
                                     minFractionDigits="2"
                                     maxFractionDigits="2"
                                     maxIntegerDigits="14"/>
                </h:outputText>
            </p:column>

            <p:column styleClass="center">
                <p:commandButton icon="ui-icon-pencil"
                                 rendered="#{creditFacPropose.flagButtonCollateral}"
                                 action="#{creditFacPropose.onEditSubCollateral()}"
                                 update=":subCollateralDlgForm"
                                 process="@this"
                                 oncomplete="subCollateralInfoDlg.show();">
                    <f:setPropertyActionListener value="#{i.index}"
                                                 target="#{creditFacPropose.rowCollHeadIndex}"/>
                    <f:setPropertyActionListener value="#{newCollateralSubView}"
                                                 target="#{creditFacPropose.subCollateralDetailItem}"/>
                    <f:setPropertyActionListener value="#{rowIndex}"
                                                 target="#{creditFacPropose.rowSubIndex}"/>
                    <p:resetInput target=":subCollateralDlgForm"/>
                </p:commandButton>

                <p:commandButton icon="ui-icon-trash"
                                 process="@this"
                                 rendered="#{creditFacPropose.flagButtonCollateral}"
                                 oncomplete="confirmDeleteSubCollateralInfoDlg.show()">
                    <f:setPropertyActionListener value="#{newCollateralSubView}"
                                                 target="#{creditFacPropose.subCollateralDetailItem}"/>
                </p:commandButton>
            </p:column>
        </p:dataTable>
    </td>
</tr>
<!-- Separate Line if Collateral Header more than one -->
<h:panelGroup rendered="#{not i.last}">
    <tr>
        <td colspan="4">
            <div class="separate"><!-- --></div>
        </td>
    </tr>
</h:panelGroup>
</ui:repeat>

<tr>
    <td colspan="4" style="height:28px;"></td>
</tr>
<tr>
    <td class="center" colspan="4">
        <p:commandButton id="btnSaveCollateral"
                         styleClass="small"
                         binding="#{btnSaveCollateral}"
                         value="#{msg.get('app.button.ok')}"
                         action="#{creditFacPropose.onSaveProposeCollInfo}"
                         process=":collateralDlgForm"
                         update=":collateralDlgForm,:frmMain,:msgBoxSystemMessagePanel"
                         oncomplete="handleProposeCollateralDetailRequest(xhr, status, args)"/>
        <p:spacer width="10" height=""/>
        <p:commandButton value="#{msg.get('app.button.cancel')}"
                         styleClass="small"
                         onclick="collateralInfoDlg.hide()"/>
    </td>
</tr>
<tr>
    <td colspan="4" style="height:10px;"></td>
</tr>
</table>
</h:form>
</p:panel>

<p:blockUI widgetVar="blockCollateralDlg" block="collateralDlgPanel" trigger=":collateralDlgForm:btnSaveCollateral">
    LOADING<br/>
    <p:graphicImage value="/resources/images/shared/ajax-loader.gif"/>
</p:blockUI>

</ui:composition>
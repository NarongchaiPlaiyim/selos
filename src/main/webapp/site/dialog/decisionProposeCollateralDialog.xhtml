<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui">

<p:panel id="collateralDlgPanel" styleClass="panel-dialog" style="font-size: 12px !important;">
    <h:form id="collateralDlgForm">
        <table class="content_form">
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.jobID')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:inputText id="jobID" value="#{decision.selectedAppProposeCollateral.jobID}"
                                 required="true"/>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;" >
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.appraisalDate')}"/>
                </td>
                <td class="left" colspan="3">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.appraisalDate}">
                        <f:convertDateTime pattern="dd/MM/yyyy" locale="th_TH"/>
                    </h:outputText>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecision')}"/>
                </td>
                <td class="left" colspan="3">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.aadDecision}"/>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecisionReason')}"/>
                </td>
                <td class="left" style="width: 200px;">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.aadDecisionReason}"/>
                </td>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecisionReasonDetail')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.aadDecisionReasonDetail}"/>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.usage')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.usage}"/>
                </td>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.typeOfUsage')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.typeOfUsage}"/>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel for="dlgCollateralRadioApprove" value="#{msg.get('app.decision.label.UWDecision')}"/>
                </td>
                <td class="left" colspan="3">
                    <table border="0">
                        <tr>
                            <td>#{msg.get('app.decision.label.approved')}</td>
                            <td>
                                <p:selectOneRadio id="dlgCollateralRadioApprove" value="#{decision.selectedAppProposeCollateral.approved}"
                                                  required="true">
                                    <f:selectItem itemLabel="#{msg.get('app.button.yes')}" itemValue="2"/>
                                    <f:selectItem itemLabel="#{msg.get('app.button.no')}" itemValue="1"/>
                                </p:selectOneRadio>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.decision.label.UWRemark')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:inputTextarea rows="3" cols="100" value="#{decision.selectedAppProposeCollateral.uwRemark}"/>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.mortgageCondition')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.mortgageCondition}"/>
                </td>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.mortgageConditionDetail')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedAppProposeCollateral.mortgageConditionDetail}"/>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.creditType.caption')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:dataTable id="dlgCollCrdTypeTable"
                                 value="#{decision.collateralCreditTypeList}"
                                 var="creditTypeDetailItem"
                                 selection="#{decision.selectedCollateralCrdTypeItems}"
                                 rowKey="#{creditTypeDetailItem.seq}"
                                 rowIndexVar="rowIndex"
                                 style="width: 100%; font-size: 12px !important;">

                        <p:columnGroup type="header">
                            <p:row>
                                <p:column style="width:20px; padding: 4px 10px !important;"
                                          selectionMode="multiple"/>
                                <p:column style="width:150px; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.account')}"/>
                                <p:column style="width:50px; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.requestCreditType')}"/>
                                <p:column style="width:100px; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.productProgram')}"/>
                                <p:column style="width:80px; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.creditFacility')}"/>
                                <p:column style="width:80px; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.limit')}"/>
                            </p:row>
                        </p:columnGroup>

                        <p:column styleClass="center" selectionMode="multiple"/>

                        <p:column styleClass="left">
                            #{creditTypeDetailItem.accountName}<br/>
                            #{msg.get('app.decision.tb.td.label.accNo')} #{creditTypeDetailItem.accountNumber},&#160;
                            #{msg.get('app.decision.tb.td.label.suf')} #{creditTypeDetailItem.accountSuf}
                        </p:column>

                        <p:column styleClass="center">
                            <h:outputText value="#{creditTypeDetailItem.requestType == 1 ? msg.get('app.label.new') : msg.get('app.label.change')}"/>
                        </p:column>

                        <p:column styleClass="left">
                            <h:outputText value="#{creditTypeDetailItem.productProgram.name}"/>
                        </p:column>

                        <p:column styleClass="left">
                            <h:outputText value="#{creditTypeDetailItem.creditType.name}"/>
                        </p:column>

                        <p:column styleClass="right">
                            <h:outputText value="#{creditTypeDetailItem.limit}">
                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="14"/>
                            </h:outputText>
                        </p:column>

                    </p:dataTable>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 170px;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.BDMComments')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:inputTextarea value="#{decision.selectedAppProposeCollateral.bdmComments}"
                                     cols="100" rows="3"/>
                </td>
            </tr>
            <tr>
                <td colspan="4">
                    <div class="separate"><!-- --></div>
                </td>
            </tr>

            <ui:repeat value="#{decision.selectedAppProposeCollateral.newCollateralHeadDetailViewList}"
                       var="collHeadDetail" varStatus="i">
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgPotentialColl" value="#{msg.get('app.credit.facility.propose.label.headcoll.potential')}"/>
                    </td>
                    <td class="left" colspan="3">
                        <p:selectOneMenu id="dlgPotentialColl"
                                         value="#{collHeadDetail.potentialCollateral.id}"
                                         style="min-width: 200px; width: 200px; max-width: 200px;"
                                         required="true">
                            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                            <f:selectItems value="#{decision.potentialCollateralList}"
                                           var="potentialItem"
                                           itemLabel="#{potentialItem.description}"
                                           itemValue="#{potentialItem.id}"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgCollTypePercentLTV" value="#{msg.get('app.credit.facility.propose.label.headcoll.collTypePercentLTV')}"/>
                    </td>
                    <td class="left" colspan="3">
                        <p:selectOneMenu id="dlgCollTypePercentLTV"
                                         value="#{collHeadDetail.collTypePercentLTV.id}"
                                         style="min-width: 200px; width: 200px; max-width: 200px;"
                                         required="true">
                            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                            <f:selectItems value="#{decision.collateralTypeList}"
                                           var="collTypePercentItem"
                                           itemLabel="#{collTypePercentItem.description}"
                                           itemValue="#{collTypePercentItem.id}"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgExistingCredit" value="#{msg.get('app.credit.facility.propose.label.headcoll.existingCredit')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgExistingCredit" value="#{collHeadDetail.existingCredit}"
                                     styleClass="right">
                            <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="14"/>
                            <p:ajax event="blur" update="@this"/>
                        </p:inputText>
                    </td>
                </tr>
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgTitleDeed" value="#{msg.get('app.credit.facility.propose.label.headcoll.titleDeed')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgTitleDeed" value="#{collHeadDetail.titleDeed}"/>
                    </td>
                </tr>
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgCollLocation" value="#{msg.get('app.credit.facility.propose.label.headcoll.collateralLocation')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgCollLocation" value="#{collHeadDetail.collateralLocation}" style="width: 250px;"/>
                    </td>
                </tr>
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgAppraisalValue" value="#{msg.get('app.credit.facility.propose.label.headcoll.appraisalValue')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgAppraisalValue" value="#{collHeadDetail.appraisalValue}"
                                     styleClass="right">
                            <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="14"/>
                            <p:ajax event="blur" update="@this"/>
                        </p:inputText>
                    </td>
                </tr>
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgHeadCollType" value="#{msg.get('app.credit.facility.propose.label.headcoll.headCollType')}"/>
                    </td>
                    <td class="left">
                        <p:selectOneMenu id="dlgHeadCollType"
                                         value="#{collHeadDetail.headCollType.id}"
                                         style="min-width: 200px; width: 200px; max-width: 200px;"
                                         required="true">
                            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                            <f:selectItems value="#{decision.collateralTypeList}"
                                           var="collateralTypeItem"
                                           itemLabel="#{collateralTypeItem.description}"
                                           itemValue="#{collateralTypeItem.id}"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="title" style="width: 170px;">
                        <p:outputLabel for="dlgInsuranceComp" value="#{msg.get('app.credit.facility.propose.label.headcoll.insuranceCompany')}"/>
                    </td>
                    <td class="left">
                        <p:selectOneRadio id="dlgInsuranceComp" value="#{collHeadDetail.insuranceCompany}"
                                          required="true">
                            <f:selectItem itemLabel="#{msg.get('app.button.partner')}" itemValue="2"/>
                            <f:selectItem itemLabel="#{msg.get('app.button.nonPartner')}" itemValue="1"/>
                        </p:selectOneRadio>
                    </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <p:commandButton
                                id="btnAddSubCollateralInfo"
                                value="#{msg.get('app.button.add')}"
                                styleClass="smaller"
                                process="@this"
                                action="#{decision.onAddSubCollateral()}"
                                update=":subCollateralDlgForm"
                                oncomplete="subCollateralInfoDlg.show();">
                            <f:setPropertyActionListener value="#{i.index}"
                                                         target="#{decision.rowIndexCollHead}"/>
                        </p:commandButton>
                    </td>
                </tr>

                <tr>
                    <td colspan="4">
                        <p:dataTable id="subCollateralDetailViewTable"
                                     value="#{collHeadDetail.newSubCollateralDetailViewList}"
                                     var="subCollateralDetail"
                                     rowKey="#{subCollateralDetail}"
                                     rowIndexVar="rowIndex"
                                     paginator="false"
                                     style="width: 100%; font-size: 12px !important;">

                            <p:columnGroup type="header">
                                <p:row>
                                    <p:column style="width: 20px;"/>
                                    <p:column style="width: 150px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.subcollTypeCaption')}"/>
                                    <p:column style="width: 50px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.titleDeed')}"/>
                                    <p:column style="width: 80px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.collateralOwner.AAD')}"/>
                                    <p:column style="width: 80px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.collateralOwner.UW')} "/>
                                    <p:column style="width: 80px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.mortgageType')} "/>
                                    <p:column style="width: 80px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.relatedWith')} "/>
                                    <p:column style="width: 100px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.appraisalValue')} "/>
                                    <p:column style="width: 100px;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.mortgageValue')} "/>
                                    <p:column style="width: 20px;"/>
                                </p:row>
                            </p:columnGroup>

                            <p:column styleClass="center">
                                <h:outputText value="#{rowIndex + 1}"/>
                            </p:column>

                            <p:column styleClass="left">
                                <h:outputText value="#{subCollateralDetail.subCollateralType.description}"
                                              rendered="#{not empty subCollateralDetail.subCollateralType}"/><br/>
                                #{msg.get('app.decision.tb.td.label.address')} #{subCollateralDetail.address}<br/>
                                #{msg.get('app.decision.tb.td.label.landOffice')} #{subCollateralDetail.landOffice}
                            </p:column>

                            <p:column styleClass="left">#{subCollateralDetail.titleDeed}</p:column>

                            <p:column styleClass="left">#{subCollateralDetail.collateralOwnerAAD}</p:column>

                            <p:column styleClass="left">
                                <ui:repeat value="#{subCollateralDetail.collateralOwnerUWList}"
                                           var="ownerUW" varStatus="a">
                                    <h:outputText value="#{ownerUW}"/>
                                    <h:outputText value="," rendered="#{not a.last}"/>
                                </ui:repeat>
                            </p:column>

                            <p:column styleClass="left">
                                <ui:repeat value="#{subCollateralDetail.mortgageList}"
                                           var="mortgage" varStatus="b">
                                    <h:outputText value="#{mortgage.mortgage}"/>
                                    <h:outputText value="," rendered="#{not b.last}"/>
                                </ui:repeat>
                            </p:column>

                            <p:column styleClass="left">
                                <ui:repeat value="#{subCollateralDetail.relatedWithList}"
                                           var="relatedWith" varStatus="c">
                                    <h:outputText value="#{relatedWith.subCollateralType.description}"/>
                                    <h:outputText value="," rendered="#{not c.last}"/>
                                </ui:repeat>
                            </p:column>

                            <p:column styleClass="right">
                                <h:outputText value="#{subCollateralDetail.appraisalValue}">
                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="14"/>
                                </h:outputText>
                            </p:column>

                            <p:column styleClass="right">
                                <h:outputText value="#{subCollateralDetail.mortgageValue}">
                                    <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="14"/>
                                </h:outputText>
                            </p:column>

                            <p:column styleClass="center">
                                <p:commandButton icon="ui-icon-pencil"
                                                 action="#{decision.onEditSubCollateral()}"
                                                 update=":subCollateralDlgForm"
                                                 process="@this"
                                                 oncomplete="subCollateralInfoDlg.show();">
                                    <f:setPropertyActionListener value="#{i.index}"
                                                                 target="#{decision.rowIndexCollHead}"/>
                                    <f:setPropertyActionListener value="#{subCollateralDetail}"
                                                                 target="#{decision.selectedAppSubCollateral}"/>
                                    <f:setPropertyActionListener value="#{rowIndex}"
                                                                 target="#{decision.rowIndexSubColl}"/>
                                </p:commandButton>

                                <p:commandButton title="#{msg.get('app.button.delete')}"
                                                 icon="ui-icon-trash"
                                                 oncomplete="confirmDeleteSubCollateralInfoDlg.show()">
                                    <f:setPropertyActionListener value="#{i.index}"
                                                                 target="#{decision.rowIndexCollHead}"/>
                                    <f:setPropertyActionListener value="#{rowIndex}"
                                                                 target="#{decision.rowIndexSubColl}"/>
                                </p:commandButton>
                            </p:column>

                        </p:dataTable>
                    </td>
                </tr>

                <h:panelGroup rendered="#{not i.last}">
                    <!-- Separate Line if Collateral Header more than one -->
                <tr>
                    <td colspan="4">
                        <div class="separate"><!-- --></div>
                    </td>
                </tr>
                </h:panelGroup>
            </ui:repeat>

            <tr>
                <td colspan="4" style="height:28px;"></td>
            </tr>
            <tr>
                <td colspan="4" style="text-align: center">
                    <p:commandButton id="btnSaveCollateral"
                                     styleClass="small"
                                     value="#{msg.get('app.button.ok')}"
                                     action="#{decision.onSaveProposeCollInfo()}"
                                     process="@form"
                                     update=":collateralDlgForm,:frmMain"
                                     oncomplete="handleDialogRequest(xhr, status, args, 'proposeCollateralDlg')"/>

                    <p:commandButton value="#{msg.get('app.button.cancel')}"
                                     styleClass="small"
                                     onclick="proposeCollateralDlg.hide()"/>
                </td>
            </tr>
        </table>
    </h:form>
</p:panel>

<p:blockUI widgetVar="blockCollateralDlg" block="collateralDlgPanel"
           trigger=":collateralDlgForm:btnSaveCollateral">
    LOADING<br/>
    <p:graphicImage value="/resources/images/shared/ajax-loader.gif"/>
</p:blockUI>

</ui:composition>
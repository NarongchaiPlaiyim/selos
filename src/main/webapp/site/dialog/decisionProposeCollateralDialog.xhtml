<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui">

<p:panel id="collateralDlgPanel" styleClass="panel-dialog" style="font-size: 12px !important;">
    <h:form id="collateralDlgForm">
        <table class="content_form content_table_form">
            <tr>
                <td class="title" style="width: 20%;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.jobID')}"/>
                </td>
                <td class="left" style="width: 80%" colspan="3">
                    <h:outputText value="#{decision.selectedApproveCollateral.jobID}"/>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.appraisalDate')}"/>
                </td>
                <td class="left" colspan="3">
                    <h:outputText value="#{decision.selectedApproveCollateral.appraisalDate}">
                        <f:convertDateTime pattern="dd/MM/yyyy" locale="th_TH"/>
                    </h:outputText>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecision')}"/>
                </td>
                <td class="left" colspan="3">
                    <h:outputText value="#{decision.selectedApproveCollateral.aadDecision}"/>
                </td>
            </tr>
            <tr>
                <td class="title" style="width: 20%;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecisionReason')}"/>
                </td>
                <td class="left" style="width: 30%;">
                    <h:outputText value="#{decision.selectedApproveCollateral.aadDecisionReason}"/>
                </td>
                <td class="title" style="width: 20%;">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.AADDecisionReasonDetail')}"/>
                </td>
                <td class="left" style="width: 30%">
                    <h:outputText value="#{decision.selectedApproveCollateral.aadDecisionReasonDetail}"/>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.usage')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedApproveCollateral.usage}"/>
                </td>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.typeOfUsage')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedApproveCollateral.typeOfUsage}"/>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel for="dlgCollateralRadioApprove"
                                   value="#{msg.get('app.decision.label.UWDecision')}"/>
                </td>
                <td class="left" colspan="3">
                    <table border="0" style="width: 100%">
                        <tr>
                            <td>#{msg.get('app.decision.label.approved')}</td>
                            <td>
                                <p:selectOneRadio id="dlgCollateralRadioApprove"
                                                  value="#{decision.selectedApproveCollateral.uwDecision}"
                                                  required="#{not empty param[saveCollateralButton.clientId]}">
                                    <f:selectItem itemLabel="#{msg.get('app.button.yes')}" itemValue="2"/>
                                    <f:selectItem itemLabel="#{msg.get('app.button.no')}" itemValue="1"/>
                                </p:selectOneRadio>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.decision.label.UWRemark')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:inputTextarea value="#{decision.selectedApproveCollateral.uwRemark}"
                                     rows="3" cols="100"/>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.mortgageCondition')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedApproveCollateral.mortgageCondition}"/>
                </td>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.mortgageConditionDetail')}"/>
                </td>
                <td class="left">
                    <h:outputText value="#{decision.selectedApproveCollateral.mortgageConditionDetail}"/>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.creditType.caption')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:dataTable id="dlgCollCrdTypeTable"
                                 value="#{decision.collateralCreditTypeList}"
                                 var="creditTypeDetailItem"
                                 selection="#{decision.selectedCollateralCrdTypeItems}"
                                 rowKey="#{creditTypeDetailItem.seq}"
                                 rowIndexVar="rowIndex"
                                 style="width: 100%">

                        <p:columnGroup type="header">
                            <p:row>
                                <p:column style="width: 5%; padding: 4px 10px !important;"
                                          selectionMode="multiple"/>
                                <p:column style="width: 40%; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.account')}"/>
                                <p:column style="width: 10%; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.requestCreditType')}"/>
                                <p:column style="width: 15%; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.productProgram')}"/>
                                <p:column style="width: 15%; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.creditFacility')}"/>
                                <p:column style="width: 15%; padding: 4px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.label.collateral.limit')}"/>
                            </p:row>
                        </p:columnGroup>

                        <p:column styleClass="center" selectionMode="multiple"/>

                        <p:column styleClass="left top">
                            #{creditTypeDetailItem.accountName}
                            <br/>
                            #{msg.get('app.decision.tb.td.label.accNo')} #{creditTypeDetailItem.accountNumber},&#160;
                            #{msg.get('app.decision.tb.td.label.suf')} #{creditTypeDetailItem.accountSuf}
                        </p:column>

                        <p:column styleClass="left top">
                            #{creditTypeDetailItem.requestType == 2 ? msg.get('app.label.new')
                            : creditTypeDetailItem.requestType == 1 ? msg.get('app.label.change') : ''}
                        </p:column>

                        <p:column styleClass="left top">
                            #{not empty creditTypeDetailItem.productProgramView ? creditTypeDetailItem.productProgramView.name : ''}
                        </p:column>

                        <p:column styleClass="left top">
                            #{not empty creditTypeDetailItem.creditFacilityView ? creditTypeDetailItem.creditFacilityView.name : ''}
                        </p:column>

                        <p:column styleClass="right top">
                            <h:outputText value="#{creditTypeDetailItem.limit}">
                                <f:convertNumber pattern="#,##0.##"
                                                 minFractionDigits="2" maxFractionDigits="2"
                                                 maxIntegerDigits="14"/>
                            </h:outputText>
                        </p:column>

                    </p:dataTable>
                </td>
            </tr>
            <tr>
                <td class="title">
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.label.collateral.BDMComments')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:inputTextarea value="#{decision.selectedApproveCollateral.bdmComments}"
                                     cols="100" rows="3"/>
                </td>
            </tr>

            <tr>
                <td colspan="4">
                    <div class="separate"><!-- --></div>
                </td>
            </tr>

            <!-- Collateral Head -->
            <ui:repeat value="#{decision.selectedApproveCollateral.newCollateralHeadViewList}"
                       var="collHeadDetail" varStatus="i">
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgPotentialColl"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.potential')}"/>
                    </td>
                    <td class="left" colspan="3">
                        <p:selectOneMenu id="dlgPotentialColl"
                                         value="#{collHeadDetail.potentialCollateral.id}"
                                         style="min-width: 200px; width: 200px; max-width: 200px;"
                                         required="#{not empty param[saveCollateralButton.clientId]}">
                            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                            <f:selectItems value="#{decision.potentialCollateralList}"
                                           var="potentialItem"
                                           itemLabel="#{potentialItem.description}"
                                           itemValue="#{potentialItem.id}"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgCollTypePercentLTV"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.collTypePercentLTV')}"/>
                    </td>
                    <td class="left" colspan="3">
                        <p:selectOneMenu id="dlgCollTypePercentLTV"
                                         value="#{collHeadDetail.collTypePercentLTV.id}"
                                         style="min-width: 200px; width: 200px; max-width: 200px;"
                                         required="#{not empty param[saveCollateralButton.clientId]}">
                            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                            <f:selectItems value="#{decision.collateralTypeList}"
                                           var="collTypePercentItem"
                                           itemLabel="#{collTypePercentItem.description}"
                                           itemValue="#{collTypePercentItem.id}"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgExistingCredit"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.existingCredit')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgExistingCredit"
                                     value="#{collHeadDetail.existingCredit}"
                                     maxlength="18"
                                     onclick="this.select()"
                                     onkeydown="return onKeyDownMoney(event);"
                                     onkeypress="return onKeyPressMoney(event);"
                                     styleClass="right">
                            <f:convertNumber pattern="#,##0.##"
                                             minFractionDigits="2" maxFractionDigits="2"
                                             maxIntegerDigits="14"/>
                            <p:ajax event="blur" update="@this"/>
                        </p:inputText>
                    </td>
                </tr>
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgTitleDeed"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.titleDeed')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgTitleDeed" value="#{collHeadDetail.titleDeed}"
                                     required="#{not empty param[saveCollateralButton.clientId]}"/>
                    </td>
                </tr>
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgCollLocation"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.collateralLocation')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgCollLocation" value="#{collHeadDetail.collateralLocation}"
                                     style="width: 400px;"
                                     required="#{not empty param[saveCollateralButton.clientId]}"/>
                    </td>
                </tr>
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgAppraisalValue"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.appraisalValue')}"/>
                    </td>
                    <td class="left">
                        <p:inputText id="dlgAppraisalValue"
                                     value="#{collHeadDetail.appraisalValue}"
                                     maxlength="18"
                                     onclick="this.select()"
                                     onkeydown="return onKeyDownMoney(event);"
                                     onkeypress="return onKeyPressMoney(event);"
                                     required="#{not empty param[saveCollateralButton.clientId]}"
                                     styleClass="right">
                            <f:convertNumber pattern="#,##0.##"
                                             minFractionDigits="2" maxFractionDigits="2"
                                             maxIntegerDigits="14"/>
                            <p:ajax event="blur" update="@this"/>
                        </p:inputText>
                    </td>
                </tr>
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgHeadCollType"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.headCollType')}"/>
                    </td>
                    <td class="left">
                        <p:selectOneMenu id="dlgHeadCollType"
                                         value="#{collHeadDetail.headCollType.id}"
                                         style="min-width: 200px; width: 200px; max-width: 200px;"
                                         required="#{not empty param[saveCollateralButton.clientId]}">
                            <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                            <f:selectItems value="#{decision.collateralTypeList}"
                                           var="collateralTypeItem"
                                           itemLabel="#{collateralTypeItem.description}"
                                           itemValue="#{collateralTypeItem.id}"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="title">
                        <p:outputLabel for="dlgInsuranceComp"
                                       value="#{msg.get('app.credit.facility.propose.label.headcoll.insuranceCompany')}"/>
                    </td>
                    <td class="left">
                        <p:selectOneRadio id="dlgInsuranceComp"
                                          value="#{collHeadDetail.insuranceCompany}">
                            <f:selectItem itemLabel="#{msg.get('app.button.partner')}" itemValue="2"/>
                            <f:selectItem itemLabel="#{msg.get('app.button.nonPartner')}" itemValue="1"/>
                        </p:selectOneRadio>
                    </td>
                </tr>
                <tr>
                    <td class="left" colspan="4">
                        <p:commandButton
                                id="btnAddSubCollateralInfo"
                                value="#{msg.get('app.button.add')}"
                                styleClass="smaller"
                                process="@this"
                                action="#{decision.onAddSubCollateral()}"
                                update=":subCollateralDlgForm"
                                oncomplete="subCollateralInfoDlg.show();">
                            <f:setPropertyActionListener value="#{i.index}"
                                                         target="#{decision.rowIndexCollHead}"/>
                        </p:commandButton>
                    </td>
                </tr>

                <tr>
                    <td class="left" colspan="4">
                        <p:dataTable id="subCollateralDetailViewTable"
                                     value="#{collHeadDetail.newCollateralSubViewList}"
                                     var="subCollateralDetail"
                                     rowKey="#{subCollateralDetail}"
                                     rowIndexVar="rowIndex"
                                     paginator="false"
                                     style="width: 100%;">

                            <p:columnGroup type="header">
                                <p:row>
                                    <p:column style="width: 5%;"/>
                                    <p:column style="width: 20%"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.subcollTypeCaption')}"/>
                                    <p:column style="width: 10%;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.titleDeed')}"/>
                                    <p:column style="width: 10%;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.collateralOwner.AAD')}"/>
                                    <p:column style="width: 10%;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.collateralOwner.UW')} "/>
                                    <p:column style="width: 10%;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.mortgageType')} "/>
                                    <p:column style="width: 10%;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.relatedWith')} "/>
                                    <p:column style="width: 10%;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.appraisalValue')} "/>
                                    <p:column style="width: 10%;"
                                              headerText="#{msg.get('app.credit.facility.propose.label.subcoll.mortgageValue')} "/>
                                    <p:column style="width: 5%;"/>
                                </p:row>
                            </p:columnGroup>

                            <p:column styleClass="center">
                                <h:outputText value="#{rowIndex + 1}"/>
                            </p:column>

                            <p:column styleClass="left top">
                                <h:outputText value="#{subCollateralDetail.subCollateralType.description}"
                                              rendered="#{not empty subCollateralDetail.subCollateralType}"/><br/>
                                #{msg.get('app.decision.tb.td.label.address')} #{subCollateralDetail.address}<br/>
                                #{msg.get('app.decision.tb.td.label.landOffice')} #{subCollateralDetail.landOffice}
                            </p:column>

                            <p:column styleClass="left top">#{subCollateralDetail.titleDeed}</p:column>

                            <p:column styleClass="left top">#{subCollateralDetail.collateralOwnerAAD}</p:column>

                            <p:column styleClass="left top">
                                <ui:repeat value="#{subCollateralDetail.collateralOwnerUWList}"
                                           var="ownerUW" varStatus="a">
                                    <h:outputText value="#{ownerUW}"/>
                                    <h:outputText value="," rendered="#{not a.last}"/>
                                </ui:repeat>
                            </p:column>

                            <p:column styleClass="left top">
                                <ui:repeat value="#{subCollateralDetail.mortgageList}"
                                           var="mortgage" varStatus="b">
                                    <h:outputText value="#{mortgage.mortgage}"/>
                                    <h:outputText value="," rendered="#{not b.last}"/>
                                </ui:repeat>
                            </p:column>

                            <p:column styleClass="left top">
                                <ui:repeat value="#{subCollateralDetail.relatedWithList}"
                                           var="relatedWith" varStatus="c">
                                    <h:outputText value="#{relatedWith.subCollateralType.description}"/>
                                    <h:outputText value="," rendered="#{not c.last}"/>
                                </ui:repeat>
                            </p:column>

                            <p:column styleClass="right top">
                                <h:outputText value="#{subCollateralDetail.appraisalValue}">
                                    <f:convertNumber pattern="#,##0.##"
                                                     minFractionDigits="2" maxFractionDigits="2"
                                                     maxIntegerDigits="14"/>
                                </h:outputText>
                            </p:column>

                            <p:column styleClass="right top">
                                <h:outputText value="#{subCollateralDetail.mortgageValue}">
                                    <f:convertNumber pattern="#,##0.##"
                                                     minFractionDigits="2" maxFractionDigits="2"
                                                     maxIntegerDigits="14"/>
                                </h:outputText>
                            </p:column>

                            <p:column styleClass="center">
                                <p:commandButton icon="ui-icon-pencil"
                                                 action="#{decision.onEditSubCollateral()}"
                                                 update=":subCollateralDlgForm"
                                                 process="@this"
                                                 oncomplete="subCollateralInfoDlg.show();">
                                    <f:setPropertyActionListener value="#{i.index}"
                                                                 target="#{decision.rowIndexCollHead}"/>
                                    <f:setPropertyActionListener value="#{subCollateralDetail}"
                                                                 target="#{decision.selectedApproveSubColl}"/>
                                    <f:setPropertyActionListener value="#{rowIndex}"
                                                                 target="#{decision.rowIndexSubColl}"/>
                                </p:commandButton>

                                <p:commandButton title="#{msg.get('app.button.delete')}"
                                                 icon="ui-icon-trash"
                                                 process="@this"
                                                 oncomplete="confirmDeleteSubCollateralInfoDlg.show()">
                                    <f:setPropertyActionListener value="#{i.index}"
                                                                 target="#{decision.rowIndexCollHead}"/>
                                    <f:setPropertyActionListener value="#{rowIndex}"
                                                                 target="#{decision.rowIndexSubColl}"/>
                                </p:commandButton>
                            </p:column>

                        </p:dataTable>
                    </td>
                </tr>
                <!-- Separate Line if Collateral Header more than one -->
                <h:panelGroup rendered="#{not i.last}">
                    <tr>
                        <td colspan="4">
                            <div class="separate"><!-- --></div>
                        </td>
                    </tr>
                </h:panelGroup>
            </ui:repeat>

            <tr>
                <td colspan="4" style="height:28px;"></td>
            </tr>
            <tr>
                <td colspan="4" style="text-align: center">
                    <p:commandButton id="btnSaveCollateral"
                                     styleClass="small"
                                     value="#{msg.get('app.button.ok')}"
                                     binding="#{saveCollateralButton}"
                                     action="#{decision.onSaveProposeCollInfo()}"
                                     process="@form"
                                     update=":collateralDlgForm,:frmMain,:msgBoxSystemMessagePanel"
                                     oncomplete="handleDialogRequest(xhr, status, args, 'proposeCollateralDlg')"/>
                    <p:spacer width="10" height=""/>
                    <p:commandButton value="#{msg.get('app.button.cancel')}"
                                     styleClass="small"
                                     onclick="proposeCollateralDlg.hide()"/>
                </td>
            </tr>
            <tr>
                <td colspan="4" style="height:10px;"></td>
            </tr>
        </table>
    </h:form>
</p:panel>

<p:blockUI widgetVar="blockCollateralDlg" block="collateralDlgPanel"
           trigger=":collateralDlgForm:btnSaveCollateral">
    LOADING<br/>
    <p:graphicImage value="/resources/images/shared/ajax-loader.gif"/>
</p:blockUI>

</ui:composition>
<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui">

<p:panel id="creditInfoDlgPanel" styleClass="panel-dialog">
    <h:form id="creditInfoDlgForm">
        <table class="content_form content_table_form">
            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.type')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:selectOneRadio value="#{proposeLine.proposeCreditInfoDetailView.requestType}"
                                      required="#{not empty param[saveBtn.clientId]}"
                                      disabled="#{proposeLine.modeEdit}">
                        <f:selectItem itemLabel="#{msg.get('app.button.new')}" itemValue="2"/>
                        <f:selectItem itemLabel="#{msg.get('app.button.change')}" itemValue="1"/>
                        <p:ajax event="change" listener="#{proposeLine.onChangeRequestType()}"
                                process="@this" update=":creditInfoDlgForm"/>
                    </p:selectOneRadio>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.refinance')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:selectOneRadio value="#{proposeLine.proposeCreditInfoDetailView.refinance}" required="#{not empty param[saveBtn.clientId]}">
                        <f:selectItem itemLabel="#{msg.get('app.button.yes')}" itemValue="2"/>
                        <f:selectItem itemLabel="#{msg.get('app.button.no')}" itemValue="1"/>
                        <p:ajax event="change" process="@this" update=":creditInfoDlgForm"/>
                    </p:selectOneRadio>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.productProgram')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:selectOneMenu id="dlgSelProdProgram"
                                     value="#{proposeLine.proposeCreditInfoDetailView.productProgramView.id}"
                                     style="min-width: 200px; width: 200px; max-width: 200px;"
                                     required="#{not empty param[saveBtn.clientId]}">
                        <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                        <f:selectItems value="#{proposeLine.productProgramViewList}"
                                       var="prdGroupToPrdProgramItem"
                                       itemLabel="#{prdGroupToPrdProgramItem.productProgramView.name}"
                                       itemValue="#{prdGroupToPrdProgramItem.productProgramView.id}"/>
                        <p:ajax event="change" listener="#{proposeLine.onChangeProductProgram()}" process="@this" update=":creditInfoDlgForm"/>
                    </p:selectOneMenu>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.creditType')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:selectOneMenu id="dlgSelCreditType"
                                     value="#{proposeLine.proposeCreditInfoDetailView.creditTypeView.id}"
                                     style="min-width: 200px; width: 200px; max-width: 200px;"
                                     required="#{not empty param[saveBtn.clientId]}">
                        <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                        <f:selectItems value="#{proposeLine.creditTypeViewList}"
                                       var="creditTypeItem"
                                       itemLabel="#{creditTypeItem.creditTypeView.name}"
                                       itemValue="#{creditTypeItem.creditTypeView.id}"/>
                        <p:ajax event="change" listener="#{proposeLine.onChangeCreditType}"
                                process=":creditInfoDlgForm:dlgSelCreditType, :creditInfoDlgForm:dlgSelProdProgram"
                                update=":creditInfoDlgForm"/>
                    </p:selectOneMenu>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.productCode')}"/>
                </td>
                <td class="left">
                    <p:inputText id="productCode" value="#{proposeLine.proposeCreditInfoDetailView.productCode}">
                        <p:ajax event="blur" update="@this"/>
                    </p:inputText>
                </td>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.projectCode')}"/>
                </td>
                <td class="left">
                    <p:inputText id="projectCode" value="#{proposeLine.proposeCreditInfoDetailView.projectCode}"
                                 required="#{not empty param[saveBtn.clientId]}">
                        <p:ajax event="blur" update="@this"/>
                    </p:inputText>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.limitNotional')}"/>
                </td>
                <td class="left">
                    <p:inputText id="limit" value="#{proposeLine.proposeCreditInfoDetailView.limit}"
                                 maxlength="14"
                                 onclick="this.select()"
                                 onkeydown="return onKeyDownNegMoney(event);"
                                 onkeypress="return onKeyPressNegMoney(event);"
                                 onfocus="removeComma(this)"
                                 required="#{not empty param[saveBtn.clientId]}"
                                 style="width:200px;text-align: right">
                        <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                        <p:ajax event="blur" update="@this"/>
                    </p:inputText>
                </td>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.pcePercent')}"/>
                </td>
                <td class="left">
                    <p:inputText value="#{proposeLine.proposeCreditInfoDetailView.PCEPercent}"
                                 maxlength="6"
                                 onclick="this.select()"
                                 onkeydown="return onKeyDownMoney(event);"
                                 onkeypress="return onKeyPressMoney(event);"
                                 onfocus="removeComma(this)"
                                 styleClass="right"
                                 required="#{not empty param[saveBtn.clientId]}">
                        <f:convertNumber pattern="##0.00" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="3"/>
                        <f:validateDoubleRange maximum="100"/>
                        <p:ajax event="blur" update="@this"/>
                    </p:inputText>
                    <p:spacer width="5" height="0"/>
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.percent')}"/>
                </td>
            </tr>

            <tr>
                <td colspan="2"></td>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.pceAmt')}"/>
                </td>
                <td class="left">
                    <p:inputText value="#{proposeLine.proposeCreditInfoDetailView.PCEAmount}"
                                 id="PCEAmount"
                                 maxlength="14"
                                 onclick="this.select()"
                                 onkeydown="return onKeyDownMoney(event);"
                                 onkeypress="return onKeyPressMoney(event);"
                                 onfocus="removeComma(this)"
                                 required="#{not empty param[saveBtn.clientId]}"
                                 style="width:200px; min-width:200px; max-width:200px; text-align: right"
                                 readonly="true">
                        <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                        <p:ajax event="blur" update="@this"/>
                    </p:inputText>
                </td>
            </tr>

            <tr>
                <td colspan="4">
                    <div class="separate"><!-- --></div>
                </td>
            </tr>

            <tr>
                <td class="left" colspan="2">
                    <p:selectBooleanCheckbox value="#{proposeLine.proposeCreditInfoDetailView.reducePriceFlag}"
                                             id="reducePriceFlagChk"
                                             disabled="#{proposeLine.proposeCreditInfoDetailView.cannotCheckReducePricing}">
                        <p:ajax update="@this"/>
                    </p:selectBooleanCheckbox>
                    <p:spacer width="5" height="0"/>
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.dlg.label.reducePricing')}"/>
                </td>
                <td class="left" colspan="2">
                    <p:selectBooleanCheckbox value="#{proposeLine.proposeCreditInfoDetailView.reduceFrontEndFee}"
                                             id="reduceFrontEndFeeChk"
                                             disabled="#{proposeLine.proposeCreditInfoDetailView.cannotCheckReduceFront}">
                        <p:ajax update="@this"/>
                    </p:selectBooleanCheckbox>
                    <p:spacer width="5" height="0"/>
                    <p:outputLabel value="#{msg.get('app.credit.facility.propose.dlg.label.reduceFront')}"/>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.standard')}"/>
                </td>
                <td class="left" colspan="3">
                    <table border="0">
                        <tr>
                            <td>
                                <p:selectOneMenu id="standDlg"
                                                 value="#{proposeLine.proposeCreditInfoDetailView.standardBaseRate.id}"
                                                 style="width: 50px;"
                                                 disabled="true">
                                    <f:selectItems value="#{proposeLine.baseRateList}" var="standard"
                                                   itemLabel="#{standard.name}"
                                                   itemValue="#{standard.id}"/>
                                    <p:ajax event="change" process="@this" update="@this" listener="#{proposeLine.onChangeBaseRate()}"/>
                                </p:selectOneMenu>
                            </td>
                            <td>
                                <p:inputText id="standPriceDlg"
                                             value="#{proposeLine.proposeCreditInfoDetailView.standardInterest}"
                                             maxlength="6"
                                             onclick="this.select()"
                                             onkeydown="return onKeyDownNegMoney(event);"
                                             onkeypress="return onKeyPressNegMoney(event);"
                                             onfocus="removeComma(this)"
                                             style="width: 50px;"
                                             styleClass="right"
                                             disabled="true">
                                    <f:convertNumber pattern="##0.##"  minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="3"/>
                                    <p:ajax event="blur" update="@this"/>
                                </p:inputText>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.suggest')}"/>
                </td>
                <td class="left" colspan="3">
                    <table border="0">
                        <tr>
                            <td>
                                <p:selectOneMenu id="suggestDlg"
                                                 value="#{proposeLine.proposeCreditInfoDetailView.suggestBaseRate.id}"
                                                 style="width: 50px;"
                                                 disabled="#{proposeLine.proposeCreditInfoDetailView.requestTypeMode != 3}">
                                    <f:selectItems value="#{proposeLine.baseRateList}" var="suggest"
                                                   itemLabel="#{suggest.name}"
                                                   itemValue="#{suggest.id}"/>
                                    <p:ajax event="change" process="@this" update="@this" listener="#{proposeLine.onChangeBaseRate()}"/>
                                </p:selectOneMenu>
                            </td>
                            <td>
                                <p:inputText id="suggestPriceDlg"
                                             value="#{proposeLine.proposeCreditInfoDetailView.suggestInterest}"
                                             maxlength="6"
                                             onclick="this.select()"
                                             onkeydown="return onKeyDownNegMoney(event);"
                                             onkeypress="return onKeyPressNegMoney(event);"
                                             onfocus="removeComma(this)"
                                             style="width: 50px;"
                                             styleClass="right"
                                             disabled="#{proposeLine.proposeCreditInfoDetailView.requestTypeMode != 3}">
                                    <f:convertNumber pattern="##0.##"  minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="3"/>
                                    <p:ajax event="blur" update="@this"/>
                                </p:inputText>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.final')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:commandButton
                            value="#{msg.get('app.button.add')}"
                            styleClass="smaller"
                            id="addTier"
                            process="@this"
                            update=":creditInfoDlgForm:resultFinal"
                            disabled="#{proposeLine.proposeCreditInfoDetailView.requestTypeMode == 2}"
                            actionListener="#{proposeLine.onAddTierInfo()}">
                    </p:commandButton>
                </td>
            </tr>

            <tr>
                <td class="title"></td>
                <td class="left" colspan="3">
                    <p:dataTable id="resultFinal"
                                 var="item"
                                 value="#{proposeLine.proposeCreditInfoDetailView.proposeCreditInfoTierDetailViewList}"
                                 rowKey="#{item.newCreditTierDetailView}"
                                 rowIndexVar="rowIndex"
                                 style="width: 100% !important;">

                        <p:columnGroup type="header">
                            <p:row>
                                <p:column style="width: 5%; padding: 5px 10px !important;"/>
                                <p:column style="width: 30%; padding: 5px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.dlg.tb.header.price')}"/>
                                <p:column style="width: 30%; padding: 5px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.dlg.tb.header.tenor')}"/>
                                <p:column style="width: 30%; padding: 5px 10px !important;"
                                          headerText="#{msg.get('app.credit.facility.propose.dlg.tb.header.installment')}"/>
                                <p:column style="width: 5%; padding: 5px 10px !important;"/>
                            </p:row>
                        </p:columnGroup>

                        <p:column styleClass="center top">
                            <h:outputText value="#{rowIndex+1}"/>
                        </p:column>

                        <p:column styleClass="center top">
                            <p:panelGrid styleClass="panelGridPadding0">
                                <p:row>
                                    <p:column>
                                        <p:selectOneMenu value="#{item.finalBasePrice.id}" id="finalBase"
                                                         style="width: 50px;"
                                                         disabled="#{item.brmsFlag == 1}">
                                            <f:selectItems value="#{proposeLine.baseRateList}"
                                                           var="finalBase"
                                                           itemLabel="#{finalBase.name}"
                                                           itemValue="#{finalBase.id}"/>
                                            <p:ajax event="change" process="@this" update="@this" listener="#{proposeLine.onChangeBaseRate(rowIndex)}"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column>
                                        <p:inputText value="#{item.finalInterest}"
                                                     onclick="this.select()"
                                                     id="finalInterest"
                                                     onkeydown="return onKeyDownNegMoney(event);"
                                                     onkeypress="return onKeyPressNegMoney(event);"
                                                     onfocus="removeComma(this)"
                                                     style="width: 50px;"
                                                     styleClass="right"
                                                     readonly="#{item.brmsFlag == 1}">
                                            <f:convertNumber pattern="##0.##" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="3"/>
                                            <p:ajax event="blur" update="@this"/>
                                        </p:inputText>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:column>

                        <p:column styleClass="center top">
                            <p:inputText id="tenor" value="#{item.tenor}"
                                         maxlength="3"
                                         onclick="this.select()"
                                         onkeydown="return onKeyDownMoney(event);"
                                         onkeypress="return onKeyPressMoney(event);"
                                         onfocus="removeComma(this)"
                                         styleClass="right">
                                <f:convertNumber pattern="###" integerOnly="true" maxIntegerDigits="3"/>
                                <p:ajax event="blur" update="@this"/>
                            </p:inputText>
                        </p:column>

                        <p:column styleClass="center top">
                            <p:inputText id="installment" value="#{item.installment}"
                                         maxlength="14"
                                         onclick="this.select()"
                                         onkeydown="return onKeyDownMoney(event);"
                                         onkeypress="return onKeyPressMoney(event);"
                                         onfocus="removeComma(this)"
                                         style="width:170px; text-align: right"
                                         readonly="#{item.brmsFlag == 1}">
                                <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" maxIntegerDigits="14"/>
                                <p:ajax event="blur" update="@this"/>
                            </p:inputText>
                        </p:column>

                        <p:column styleClass="center top">
                            <p:commandButton icon="ui-icon-trash"
                                             rendered="#{item.brmsFlag != 1}"
                                             process="@form"
                                             update=":creditInfoDlgForm"
                                             actionListener="#{proposeLine.onDeleteProposeTierInfo(rowIndex)}">
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.frontEnd')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:inputText id="frontEndFee"
                                 value="#{proposeLine.proposeCreditInfoDetailView.frontEndFee}"
                                 maxlength="6"
                                 readonly="#{proposeLine.proposeCreditInfoDetailView.requestTypeMode != 1}"
                                 onclick="this.select()"
                                 onkeydown="return onKeyDownMoney(event);"
                                 onkeypress="return onKeyPressMoney(event);"
                                 onfocus="removeComma(this)"
                                 styleClass="right"
                                 required="#{not empty param[saveBtn.clientId]}">
                        <f:convertNumber pattern="##0.00"
                                         minFractionDigits="2"
                                         maxFractionDigits="2"
                                         maxIntegerDigits="3"/>
                        <f:validateDoubleRange maximum="100"/>
                        <p:ajax event="blur" update="@this"/>
                    </p:inputText>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.loanPurpose')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:selectOneMenu id="dlgLoanPurpose"
                                     value="#{proposeLine.proposeCreditInfoDetailView.loanPurposeView.id}"
                                     style="min-width: 400px; width: 400px; max-width: 400px;"
                                     required="#{not empty param[saveBtn.clientId]}">
                        <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                        <f:selectItems value="#{proposeLine.loanPurposeViewList}"
                                       var="loanPurposeItem"
                                       itemLabel="#{loanPurposeItem.description}"
                                       itemValue="#{loanPurposeItem.id}"/>
                        <p:ajax event="change" process="@this" update="@this"/>
                    </p:selectOneMenu>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.purposeDetail')}"/>
                </td>
                <td class="left" colspan="3">
                    <p:inputTextarea value="#{proposeLine.proposeCreditInfoDetailView.proposeDetail}"
                                     cols="100" rows="3">
                        <p:ajax event="blur" update="@this"/>
                    </p:inputTextarea>
                </td>
            </tr>

            <tr>
                <td class="title">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.disbursement')}"/>
                </td>
                <td class="left">
                    <p:selectOneMenu id="dlgDisbursement"
                                     value="#{proposeLine.proposeCreditInfoDetailView.disbursementTypeView.id}"
                                     style="min-width: 200px; width: 200px; max-width: 200px;"
                                     required="#{not empty param[saveBtn.clientId]}">
                        <f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
                        <f:selectItems value="#{proposeLine.disbursementTypeViewList}"
                                       var="disbursementItem"
                                       itemLabel="#{disbursementItem.disbursement}"
                                       itemValue="#{disbursementItem.id}"/>
                        <p:ajax event="change" process="@this" update="@this"/>
                    </p:selectOneMenu>
                </td>
                <td class="title" style="width:200px;">
                    <h:outputText value="#{msg.get('app.credit.facility.propose.dlg.label.holdLimitAmt')}"/>
                </td>
                <td class="left">
                    <p:inputText value="#{proposeLine.proposeCreditInfoDetailView.holdLimitAmount}"
                                 maxlength="14"
                                 onclick="this.select()"
                                 onkeydown="return onKeyDownMoney(event);"
                                 onkeypress="return onKeyPressMoney(event);"
                                 onfocus="removeComma(this)"
                                 style="width:200px;text-align: right">
                        <f:convertNumber pattern="#,##0.##" minFractionDigits="2" maxFractionDigits="2" type="number"/>
                        <p:ajax event="blur" update="@this"/>
                    </p:inputText>
                </td>
            </tr>

            <tr>
                <td colspan="4" style="height:28px;"></td>
            </tr>

            <tr>
                <td colspan="4" class="center">
                    <p:commandButton id="dlgSaveCreditBtn"
                                     styleClass="small"
                                     value="#{msg.get('app.button.ok')}"
                                     binding="#{saveBtn}"
                                     action="#{proposeLine.onSaveCreditInfo()}"
                                     process="@form"
                                     update=":creditInfoDlgForm,:frmMain"
                                     oncomplete="handleDialogRequest(xhr, status, args, 'creditInfoDlg')"/>
                    <p:spacer width="10" height="0"/>
                    <p:commandButton value="#{msg.get('app.button.cancel')}"
                                     styleClass="small"
                                     onclick="PF('creditInfoDlg').hide()"/>
                </td>
            </tr>

            <tr>
                <td colspan="4" style="height:10px;"></td>
            </tr>
        </table>
    </h:form>
</p:panel>

<p:blockUI widgetVar="blockcreditInfoDlg" block="creditInfoDlgPanel" trigger=":creditInfoDlgForm:dlgSaveCreditBtn">
    LOADING<br/>
    <p:graphicImage value="/resources/images/shared/ajax-loader.gif"/>
</p:blockUI>

<ui:include src="confirmDeleteDlg.xhtml">
    <ui:param name="id" value="confirmDeleteTierInfoDialog"/>
    <ui:param name="name" value="confirmDeleteTierInfoDlg"/>
    <ui:param name="formId" value="frmConfirmDeleteTierInfo"/>
    <ui:param name="controller" value="#{proposeLine}"/>
    <ui:param name="action" value="onDeleteProposeTierInfo"/>
    <ui:param name="update" value=":frmMain"/>
</ui:include>
</ui:composition>
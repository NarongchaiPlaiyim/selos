<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:clv="http://clevel.com/ui">
<h:form id="openAccountFrm">
	<p:scrollPanel style="height:530px" styleClass="panel-dialog"
	mode="native" 
		rendered="#{not empty accountInfo.openAccount}">	
			<p:messages />
			<table class="content_form">
				<tr>
					<td class="title" style="width:180px">
						<p:outputLabel
							for="requestType"
							value="#{msg.get('app.accountInfo.account.dialog.requestAccountType')}" />
					</td>
					<td>
						<p:selectOneRadio id="requestType"
							disabled="#{accountInfo.openAccount.fromPledge}" 
							value="#{accountInfo.openAccount.requestAccountType}"
							required="true" requiredMessage="#{msg.get('app.accountInfo.account.requestType.validate')}"
							>
							<p:ajax update="confirmOpenAccount"/>
                        	<f:selectItems value="#{enumGeneralControl.requestAccountTypes}" var="requesttype"
                        		itemLabel="#{msg.get(requesttype.msgKey)}" itemValue="#{requesttype}" 
                        		/>
                        </p:selectOneRadio>
					</td>
				</tr>
				<tr>
					<td class="title">
						<p:outputLabel
							for="accountNo"
							value="#{msg.get('app.accountInfo.account.dialog.accountNo')}" />
					</td>
					<td>
						<p:inputText id="accountNo"
							required="true" requiredMessage="#{msg.get('app.accountInfo.account.accountNo.validate')}" 
							readonly="#{accountInfo.openAccount.fromPledge}"
							value="#{accountInfo.openAccount.accountNo}"
							/>
					</td>
				</tr>
				<tr>
					<td class="title">
						<p:outputLabel
							for="branch"
							value="#{msg.get('app.accountInfo.account.dialog.branch')}" />
					</td>
					<td>
						<p:selectOneMenu id="branch" style="width:200px"
							value="#{accountInfo.openAccount.branchId}"
							required="true" requiredMessage="#{msg.get('app.accountInfo.account.branch.validate')}"
							>
							<f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
							<f:selectItems value="#{accountInfo.branches}"/>
						</p:selectOneMenu>
					</td>
				</tr>
				<tr>
					<td class="title">
						<p:outputLabel
							for="accountType"
							value="#{msg.get('app.accountInfo.account.dialog.accountType')}" />
					</td>
					<td>
						<p:selectOneMenu id="accountType" style="width:200px"
							value="#{accountInfo.openAccount.accountTypeId}"
							binding="#{accountInfo.accountTypeBind}"
							required="true" requiredMessage="#{msg.get('app.accountInfo.account.accountType.validate')}"
							>
							<p:ajax update="productType" listener="#{accountInfo.onSelectAccountType()}"
								/>
							<f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue="-1"/>
							<f:selectItems value="#{accountInfo.accountTypes}"/>
						</p:selectOneMenu>
					</td>
				</tr>
				<tr>
					<td class="title">
						<p:outputLabel
							for="productType"
							value="#{msg.get('app.accountInfo.account.dialog.productType')}" />
					</td>
					<td>
						<p:selectOneMenu id="productType" style="width:200px"
							value="#{accountInfo.openAccount.productTypeId}"
							binding="#{accountInfo.productTypeBind}"
							required="true" requiredMessage="#{msg.get('app.accountInfo.account.productType.validate')}"
							>
							<f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue="-1"/>
							<f:selectItems value="#{accountInfo.productTypes}"/>
						</p:selectOneMenu>
					</td>
				</tr>
				<tr>
					<td class="title">
						<p:outputLabel
							for="term" 
							value="#{msg.get('app.accountInfo.account.dialog.term')}" />
					</td>
					<td>
						<p:inputText id="term" styleClass="smaller"
							maxlength="3"
							value="#{accountInfo.openAccount.term}"
							onkeydown="return onKeyDownNumber(event)"
							onkeypress="return onKeyPressNumber(event)"
							required="true" requiredMessage="#{msg.get('app.accountInfo.account.term.validate')}"
							/>
					</td>
				</tr>
				<tr>
					<td class="title">
						<p:outputLabel for="accountName"
							value="#{msg.get('app.accountInfo.account.dialog.accountName')}" />
					</td>
					<td class="middle">
						<p:selectOneMenu id="accountName" style="width:200px;margin-right:10px"
							styleClass="inline_select"
							value="#{accountInfo.selectedAddAccountNameId}"
							>
							<p:ajax update="addNameBtn" />
							<f:selectItem itemLabel="#{msg.get('app.select.item0')}" itemValue=""/>
							<f:selectItems value="#{accountInfo.toAddAccountNameList}"/>
						</p:selectOneMenu>
						
						<p:commandButton id="addNameBtn" style="margin-top:2px"
							value="#{msg.get('app.button.add')}"
							styleClass="medium"
							process="@this"
							partialSubmit="true"
							immediate="true"
							actionListener="#{accountInfo.onAddOpenAccountName()}"
							disabled="#{accountInfo.selectedAddAccountNameId le 0}"
							update="accountname_tbl,accountName"
							/>
					</td>
				</tr>
				<tr>
					<td></td>
					<td>
						<p:dataTable id="accountname_tbl" styleClass="content_table_form"
							value="#{accountInfo.openAccount.names}" var="name"
							rowIndexVar="rowIdx" style="margin:10px 0"
							>
							<p:column style="width:20px" styleClass="center">
								#{rowIdx+1}
							</p:column>
							<p:column style="width:200px"
								headerText="#{msg.get('app.accountInfo.account.dialog.accountName.table')}"
								>
								#{name.name}
							</p:column>
							<p:column style="width:30px" styleClass="center">
								<p:commandButton icon="ui-icon-trash" title="#{msg.get('app.button.delete')}"
               						process="@this"
                					style="margin-right:0px !important;margin-bottom:4px !important"
                					rendered="#{not name.fromPledge}"
                					actionListener="#{accountInfo.onDeleteOpenAccountName(name.customerId)}"
                					update="accountname_tbl,:openAccountFrm:accountName,:openAccountFrm:addNameBtn"
                                 	>
                                 </p:commandButton>
							</p:column>
						</p:dataTable>
					</td>
				</tr>
				<tr>
					<td class="title top">
						<p:outputLabel for="purpose_pane"
							value="#{msg.get('app.accountInfo.account.dialog.purpose')}" />
					</td>
					<td>
						<h:panelGroup id="purpose_pane" layout="block">
							<ui:repeat var="purpose" value="#{accountInfo.openAccount.purposes}">
								<p:selectBooleanCheckbox itemLabel="#{purpose.purpose}"
									styleClass="normal_checkbox" style="display:block;margin-top:4px;margin-bottom:4px"
									value="#{purpose.checked}" disabled="#{not purpose.editable}" 
									/>
							</ui:repeat>
						</h:panelGroup>
					</td>
				</tr>
				<tr>
					<td class="title">
						<p:outputLabel
							for="confirmOpenAccount"
							value="#{msg.get('app.accountInfo.account.dialog.confirmOpenAccount')}" />
					</td>
					<td>
						<p:selectOneRadio
							id="confirmOpenAccount" disabled="true" 
							value="#{accountInfo.openAccount.confirmAccountType}">
							<f:selectItems value="#{enumGeneralControl.confirmAccountTypes}" var="confirmtype"
                        		itemLabel="#{msg.get(confirmtype.msgKey)}" itemValue="#{confirmtype}" 
                        		/>
                        </p:selectOneRadio>
					</td>
				</tr>
				<tr>
					<td class="title top">
						<p:outputLabel
							for="credit_tbl"
							value="#{msg.get('app.accountInfo.account.dialog.creditType')}" />
					</td>
					<td>
						<p:dataTable id="credit_tbl" styleClass="content_table_form"
						 	value="#{accountInfo.openAccount.credits}" var="credit"
						 	style="margin:10px 0"
							>
							<p:column style="width:30px" styleClass="center">
								<p:selectBooleanCheckbox styleClass="normal_checkbox"
									value="#{credit.checked}"
									disabled="#{credit.fromPledge}" 
									/>
							</p:column>
							<p:column style="width:200px" 
								headerText="#{msg.get('app.accountInfo.account.dialog.creditType.productProgram')}"
								>
								#{credit.productProgram}
							</p:column>
							<p:column 
								headerText="#{msg.get('app.accountInfo.account.dialog.creditType.creditFacility')}"
								>
								#{credit.creditFacility}
							</p:column>
							<p:column style="width:150px" styleClass="right" 
								headerText="#{msg.get('app.accountInfo.account.dialog.creditType.limit')}"
								>
								<h:outputText value="#{credit.limit}">
									<f:convertNumber pattern="#,##0.00"/>
								</h:outputText>
							</p:column>
						</p:dataTable>
					</td>
				</tr>
				 <tr>
	                <td colspan="2">
	                    <p:spacer></p:spacer>
	                </td>
	            </tr>
				<tr>
					<td colspan="2" class="center">
						<p:commandButton
	                         id="addOpenAccountBtn"
	                         value="#{msg.get('app.button.ok')}"
	                         actionListener="#{accountInfo.onAddOpenAccount()}"
	                         update=":frmMain:accountinfo_tbl,:openAccountFrm"
	                         oncomplete="handleDialogRequest(xhr, status, args,'p_openAccountDlg')"
	                         styleClass="small"
	                         rendered="#{accountInfo.addDialog}"/>
	                     <p:commandButton
	                         id="updOpenAccountBtn"
	                         value="#{msg.get('app.button.ok')}"
	                         actionListener="#{accountInfo.onUpdateOpenAccount()}"
	                         update=":frmMain:accountinfo_tbl,:openAccountFrm"
	                         oncomplete="handleDialogRequest(xhr, status, args,'p_openAccountDlg')"
	                         styleClass="small"
	                         rendered="#{not accountInfo.addDialog}"/>
	                    <p:commandButton
	                    	type='button' styleClass="small" 
	                    	value="#{msg.get('app.button.cancel')}" onclick="p_openAccountDlg.hide()"/>
	                    
					</td>
				</tr>
				<tr>
	                <td colspan="2">
	                    <p:spacer></p:spacer>
	                </td>
	            </tr>
			</table>
	</p:scrollPanel>
	<p:blockUI block="openAccountFrm" trigger="addOpenAccountBtn,updOpenAccountBtn">
	    LOADING<br />
	    <p:graphicImage value="/resources/images/shared/ajax-loader.gif"/>
	</p:blockUI>
</h:form>

</ui:composition>
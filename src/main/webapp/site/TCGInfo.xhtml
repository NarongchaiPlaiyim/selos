<!DOCTYPE html>
<html>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>SE-LOS : TCG Calculation</title>
    <link type="text/css" rel="stylesheet" href="#{request.contextPath}/resources/css/style.css"/>
    <script type="text/javascript" language="javascript" src="#{request.contextPath}/resources/js/jquery.numeric.js"/>
    <script type="text/javascript" language="javascript" src="#{request.contextPath}/resources/js/custom.js"/>
</h:head>

<h:body>
    <p:panel id="pnl_maincontainer">
        <h:form id="frmMain">
            <div id="main_container">
                <!-- Start Header Logo -->
                <ui:include src="include/header_logo.xhtml"/>
                <!-- End Header Logo -->
                <!-- Start Header Detail -->
                <ui:include src="include/header_detail.xhtml"/>
                <!-- End Header Detail -->
                <!-- Start Menu -->
                <ui:include src="include/menubar.xhtml"/>
                <!-- End Menu -->
                <div id="content_container">
                    <div id="content_name">TCG Calculation</div>
                    <div id="content">
                        <div id="content_info">
                            <div id="content_trackchange" title="Click to view Track Change">[ View Track Change ]
                            </div>
                            <div id="content_lastupdate">Last update by <h:outputText id="lastupdateName"
                                                                                      value="MR.BDM Maker"/>,
                                <h:outputText id="lastupdateTime" value="18/08/2556 11:11:01"/></div>
                        </div>
                        <div id="content_form">
                            <!-- start content -->
                            <table id="content_form_cal" style="width:100%">

                                <tr>
                                    <td colspan="2"><h2>GUARANTEE CHECKLIST COLLATERAL CALCULATION</h2></td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <table class="table_noborder" style="padding-left: 100px;">
                                            <tr>
                                                <td class="title">
                                                    <h:outputText value="#{msg.get('app.isTCG')}" />:
                                                </td>
                                                <td>
                                                    <h:selectOneRadio id="radio" value="#{tcgInfo.TCGView.TCG}" >
                                                        <f:selectItem itemLabel="No" itemValue="false"/>
                                                        <f:selectItem itemLabel="Yes" itemValue="true"/>
                                                    </h:selectOneRadio>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="title" style="width: 450px;">
                                                    <h:outputText value="#{msg.get('app.requestLimitRequiredTCG')}" />:
                                                </td>
                                                <td>
                                                    <p:inputText styleClass="large right" id="requestLimitRequiredTCG"  value="#{tcgInfo.TCGView.requestLimitRequiredTCG}" >
                                                        <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                        <p:ajax event="blur" update="@this"/>
                                                    </p:inputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="title">
                                                    <h:outputText value="#{msg.get('app.requestLimitNotRequiredTCG')}" />:
                                                </td>
                                                <td>
                                                    <p:inputText styleClass="large right" id="requestLimitNotRequiredTCG"  value="#{tcgInfo.TCGView.requestLimitNotRequiredTCG}"  >
                                                        <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                        <p:ajax event="blur" update="@this"/>
                                                    </p:inputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="title">
                                                    <h:outputText value="#{msg.get('app.existingLoanRatioUnderSameCollateral')}" />:
                                                </td>
                                                <td>
                                                    <p:inputText styleClass="large right" id="existingLoanRatioUnderSameCollateral"  value="#{tcgInfo.TCGView.existingLoanRatioUnderSameCollateral}"  >
                                                        <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                        <p:ajax event="blur" update="@this"/>
                                                    </p:inputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="title">
                                                    <h:outputText value="#{msg.get('app.existingLoanRatioNotUnderSameCollateral')}" />:
                                                </td>
                                                <td>
                                                    <p:inputText styleClass="large right" id="existingLoanRatioNotUnderSameCollateral"  value="#{tcgInfo.TCGView.existingLoanRatioNotUnderSameCollateral}"  >
                                                        <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                        <p:ajax event="blur" update="@this"/>
                                                    </p:inputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="title" style="width: 200px;">
                                                    <h:outputText value="#{msg.get('app.tcbFloodAmount')}" />:
                                                </td>
                                                <td>
                                                    <p:inputText styleClass="large right" id="tcbFloodAmount"  value="#{tcgInfo.TCGView.tcbFloodAmount}"  >
                                                        <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                        <p:ajax event="blur" update="@this"/>
                                                    </p:inputText>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2"><p:spacer width="2"/></td>
                                </tr>
                                <tr>
                                    <td class="left" colspan="2">
                                        <p:commandButton
                                                id="btnAdd"
                                                value="#{msg.get('app.addButton')}"
                                                styleClass="smaller"
                                                process="@this"
                                                actionListener="#{tcgInfo.onAddCollateralDetail}"
                                                update=":tcgDlgForm"
                                                oncomplete="tcgDlg.show();">
                                            <p:resetInput target=":tcgDlgForm"/>
                                        </p:commandButton>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <table>
                                            <tr>
                                                <td>
                                                    <p:dataTable id="resultCollateralDetail" var="item" value="#{tcgInfo.TCGDetailViewList}"
                                                                 paginator="false" rowKey="#{item.TCGDetailView}" rowIndexVar="rowIndex">

                                                        <p:column headerText="No." styleClass="center" style="width:20px;">
                                                            <h:outputText value="#{rowIndex+1}"/>
                                                        </p:column>

                                                        <p:column headerText="#{msg.get('app.potentialType')}"  styleClass="center" style="width: 150px;">
                                                            <h:outputText value="#{item.potentialCollateral.name}"/>
                                                        </p:column>

                                                        <p:column headerText="#{msg.get('app.collateralCollateralType')}" styleClass="center" style="width:150px;">
                                                            <h:outputText value="#{item.tcgCollateralType.name}"/>
                                                        </p:column>

                                                        <p:column headerText="#{msg.get('app.appraisalAmount')}" styleClass="right" style="width: 150px;">
                                                            <h:outputText value="#{item.appraisalAmount}">
                                                                <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                            </h:outputText>
                                                        </p:column>

                                                        <p:column headerText="#{msg.get('app.LTVvalue')}" styleClass="right" style="width: 150px;">
                                                            <h:outputText value="#{item.ltvValue}">
                                                                <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                            </h:outputText>
                                                        </p:column>

                                                        <p:column headerText="#{msg.get('app.isProposeInThisRequest')}" styleClass="center" style="width: 90px;">
                                                           <h:outputText value="#{item.proposeInThis}"/>
                                                        </p:column>


                                                        <p:column>
                                                            <p:commandButton icon="ui-icon-pencil"
                                                                             action="#{tcgInfo.onEditCollateralDetail()}"
                                                                             update=":tcgDlgForm"
                                                                             process="@this"
                                                                             oncomplete="tcgDlg.show();">
                                                                <f:setPropertyActionListener value="#{item}"
                                                                                             target="#{tcgInfo.selectCollateralItem}"/>
                                                                <f:setPropertyActionListener value="#{rowIndex}"
                                                                                             target="#{tcgInfo.rowIndex}"/>
                                                            </p:commandButton>
                                                            <p:commandButton title="Remove"
                                                                             icon="ui-icon-trash"
                                                                             oncomplete="confirmDeleteTcgDlg.show()">
                                                                <f:setPropertyActionListener value="#{item}"
                                                                                             target="#{tcgInfo.selectCollateralItem}"/>
                                                            </p:commandButton>
                                                        </p:column>

                                                      <p:columnGroup type="footer">
                                                            <p:row>
                                                                <p:column />
                                                                <p:column colspan="2" footerText="Total มูลค่าหลักประกัน: " style="text-align:right"/>
                                                                <p:column footerText="#{tcgInfo.TCGView.sumAppraisalAmtText}"  style="text-align:right" />
                                                                <p:column footerText="#{tcgInfo.TCGView.sumLtvAmtText}"  style="text-align:right"/>
                                                                <p:column colspan="2" />
                                                            </p:row>
                                                            <p:row>
                                                                <p:column />
                                                                <p:column colspan="2" footerText="Total มูลค่าหลักประกันเสนอครั้งนี้: " style="text-align:right"/>
                                                                <p:column footerText="#{tcgInfo.TCGView.sumThisAppraisalAmtText}" style="text-align:right" />
                                                                <p:column footerText="#{tcgInfo.TCGView.sumThisLtvAmtText}" style="text-align:right"/>
                                                                <p:column colspan="2" />
                                                            </p:row>
                                                        </p:columnGroup>

                                                    </p:dataTable>
                                                </td>
                                            </tr>

                                        </table>

                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <table class="table_noborder" style="padding-left: 100px;">
                                            <tr>
                                                <td class="title">
                                                    <h:outputText value="#{msg.get('app.collateralRuleResult')}" />:
                                                </td>
                                                <td>
                                                    <h:outputText styleClass="large right" value="#{tcgInfo.TCGView.collateralRuleResult}" /> %
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="title"
                                                    style="width: 300px;">
                                                    <h:outputText value="#{msg.get('app.requestTCGAmount')}" />:
                                                </td>
                                                <td>
                                                    <h:outputText styleClass="large right" id="requestTCGAmount"  value="#{tcgInfo.TCGView.requestTCGAmount}" disabled="true">
                                                        <f:convertNumber pattern="#,##0" minFractionDigits="2" maxFractionDigits="2"/>
                                                    </h:outputText>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>

                                <tr>
                                    <td colspan="100%"><p:separator/></td>
                                </tr>
                                <tr>
                                    <td colspan="2" class="center">
                                        <p:commandButton id="btnSave" value="Save"
                                                         styleClass="medium"
                                                         process=":frmMain"
                                                         action="#{tcgInfo.onSaveTcgInfo()}"
                                                         update=":frmMain"/>
                                        <p:commandButton value="#{msg.get('app.cancelButton')}"
                                                         styleClass="medium"
                                                         process=":frmMain"
                                                         action="#{tcgInfo.onCancelTcgInfo()}"
                                                         update=":frmMain"/>
                                    </td>
                                </tr>

                            </table >
                            <!-- end content -->
                        </div>
                    </div>
                    <div id="bottom_line"><!-- --></div>
                </div>
                <div class="clear"></div>
                <!-- Start Footer -->
                <ui:include src="include/footer.xhtml"/>
                <!-- End Footer -->
                <h:inputHidden id="pagename" value="mnuprescreen"/>
                <h:inputHidden id="subpagename" value="submnuprescreen"/>
            </div>
        </h:form>
    </p:panel>

    <p:dialog id="tcgDialog" header="Collateral Information" widgetVar="tcgDlg"
              modal="true" width="700" height="200">
        <ui:include src="dialog/TCGDetailDialog.xhtml"/>
    </p:dialog>

    <ui:include src="dialog/confirmDeleteDlg.xhtml">
        <ui:param name="id" value="confirmDeleteTcgDialog"/>
        <ui:param name="name" value="confirmDeleteTcgDlg"/>
        <ui:param name="formId" value="frmConfirmDeleteTcgRecord"/>
        <ui:param name="controller" value="#{tcgInfo}"/>
        <ui:param name="action" value="onDeleteTcgDetail"/>
        <ui:param name="update" value=":frmMain"/>
    </ui:include>

    <p:blockUI block="pnl_maincontainer" trigger=":frmMain:btnSave">
        Loading...
    </p:blockUI>
</h:body>
</f:view>
</html>